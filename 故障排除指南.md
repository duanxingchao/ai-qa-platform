# æ™ºèƒ½é—®ç­”ç³»ç»Ÿæ•…éšœæ’é™¤æŒ‡å—

## ğŸš¨ **å¿«é€Ÿè¯Šæ–­å‘½ä»¤**

å½“é‡åˆ°é—®é¢˜æ—¶ï¼Œè¯·æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ”¶é›†ä¿¡æ¯ï¼š

```bash
# 1. æ£€æŸ¥ç³»ç»ŸåŸºæœ¬ä¿¡æ¯
echo "=== ç³»ç»Ÿä¿¡æ¯ ==="
uname -a
cat /etc/os-release

# 2. æ£€æŸ¥DockerçŠ¶æ€
echo "=== DockerçŠ¶æ€ ==="
docker --version
docker-compose --version
systemctl status docker

# 3. æ£€æŸ¥å®¹å™¨çŠ¶æ€
echo "=== å®¹å™¨çŠ¶æ€ ==="
docker-compose -f docker-compose.ubuntu18.yml ps

# 4. æ£€æŸ¥æœåŠ¡æ—¥å¿—
echo "=== æœåŠ¡æ—¥å¿— ==="
docker-compose -f docker-compose.ubuntu18.yml logs --tail=50

# 5. æ£€æŸ¥ç«¯å£å ç”¨
echo "=== ç«¯å£çŠ¶æ€ ==="
netstat -tuln | grep -E ':(80|8088|6379|9090) '

# 6. æ£€æŸ¥ç³»ç»Ÿèµ„æº
echo "=== ç³»ç»Ÿèµ„æº ==="
free -h
df -h
```

## ğŸ”§ **å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**

### **é—®é¢˜1: Dockerå®‰è£…å¤±è´¥**

**ç—‡çŠ¶**: `command not found: docker`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆ1: ä½¿ç”¨å®˜æ–¹è„šæœ¬å®‰è£…
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# æ–¹æ¡ˆ2: æ‰‹åŠ¨å®‰è£… (Ubuntu 18.04)
sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl gnupg lsb-release
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker $USER
newgrp docker
```

### **é—®é¢˜2: Dockeræƒé™é”™è¯¯**

**ç—‡çŠ¶**: `permission denied while trying to connect to the Docker daemon socket`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ·»åŠ ç”¨æˆ·åˆ°dockerç»„
sudo usermod -aG docker $USER

# é‡æ–°åŠ è½½ç”¨æˆ·ç»„
newgrp docker

# æˆ–è€…é‡æ–°ç™»å½•
exit
# é‡æ–°SSHç™»å½•

# éªŒè¯æƒé™
docker ps
```

### **é—®é¢˜3: ç«¯å£è¢«å ç”¨**

**ç—‡çŠ¶**: `port is already allocated` æˆ– `address already in use`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tulnp | grep :80
sudo netstat -tulnp | grep :8088

# åœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡
sudo systemctl stop nginx    # å¦‚æœnginxå ç”¨80ç«¯å£
sudo systemctl stop apache2  # å¦‚æœapacheå ç”¨80ç«¯å£

# æˆ–è€…ä¿®æ”¹ç«¯å£æ˜ å°„
# ç¼–è¾‘ docker-compose.ubuntu18.yml
# å°† "80:80" æ”¹ä¸º "8080:80"
# å°† "8088:8088" æ”¹ä¸º "8089:8088"
```

### **é—®é¢˜4: æ•°æ®åº“è¿æ¥å¤±è´¥**

**ç—‡çŠ¶**: `could not connect to server` æˆ– `connection refused`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥æ•°æ®åº“é…ç½®
cat .env | grep DATABASE_URL

# 2. æµ‹è¯•ç½‘ç»œè¿é€šæ€§
telnet æ‚¨çš„æ•°æ®åº“åœ°å€ 5432

# 3. æµ‹è¯•æ•°æ®åº“è¿æ¥
docker run --rm postgres:13 psql "æ‚¨çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²" -c "SELECT version();"

# 4. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# 5. å¦‚æœæ˜¯å†…ç½‘æ•°æ®åº“ï¼Œæ£€æŸ¥VPNè¿æ¥
ping æ‚¨çš„æ•°æ®åº“åœ°å€
```

**å¸¸è§æ•°æ®åº“è¿æ¥é—®é¢˜**:
```bash
# é”™è¯¯çš„è¿æ¥æ ¼å¼
âŒ DATABASE_URL=postgresql://user:pass@host/db
âœ… DATABASE_URL=postgresql://user:pass@host:5432/db

# å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦éœ€è¦ç¼–ç 
âŒ DATABASE_URL=postgresql://user:p@ss@host:5432/db
âœ… DATABASE_URL=postgresql://user:p%40ss@host:5432/db

# ä¸»æœºåè§£æé—®é¢˜
âŒ DATABASE_URL=postgresql://user:pass@db-server:5432/db
âœ… DATABASE_URL=postgresql://user:pass@192.168.1.100:5432/db
```

### **é—®é¢˜5: å®¹å™¨å¯åŠ¨å¤±è´¥**

**ç—‡çŠ¶**: å®¹å™¨çŠ¶æ€æ˜¾ç¤º `Exited` æˆ– `Restarting`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æŸ¥çœ‹å®¹å™¨è¯¦ç»†æ—¥å¿—
docker-compose -f docker-compose.ubuntu18.yml logs backend
docker-compose -f docker-compose.ubuntu18.yml logs frontend

# 2. æ£€æŸ¥å®¹å™¨èµ„æºé™åˆ¶
docker stats

# 3. é‡æ–°æ„å»ºé•œåƒ
docker-compose -f docker-compose.ubuntu18.yml down
docker-compose -f docker-compose.ubuntu18.yml build --no-cache
docker-compose -f docker-compose.ubuntu18.yml up -d

# 4. å•ç‹¬å¯åŠ¨å®¹å™¨è¿›è¡Œè°ƒè¯•
docker-compose -f docker-compose.ubuntu18.yml run --rm backend bash
```

### **é—®é¢˜6: å†…å­˜ä¸è¶³**

**ç—‡çŠ¶**: `killed` æˆ– `out of memory`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
docker stats

# 2. å¢åŠ swapç©ºé—´
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# 3. ä¼˜åŒ–å®¹å™¨å†…å­˜é™åˆ¶
# ç¼–è¾‘ docker-compose.ubuntu18.yml
# è°ƒæ•´ mem_limit å‚æ•°

# 4. æ¸…ç†Dockerèµ„æº
docker system prune -a
```

### **é—®é¢˜7: ç£ç›˜ç©ºé—´ä¸è¶³**

**ç—‡çŠ¶**: `no space left on device`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h

# 2. æ¸…ç†Dockerèµ„æº
docker system prune -a --volumes

# 3. æ¸…ç†ç³»ç»Ÿæ—¥å¿—
sudo journalctl --vacuum-time=7d

# 4. æ¸…ç†APTç¼“å­˜
sudo apt clean
sudo apt autoremove

# 5. æŸ¥æ‰¾å¤§æ–‡ä»¶
sudo find / -type f -size +100M 2>/dev/null | head -10
```

### **é—®é¢˜8: ç½‘ç»œè¿æ¥é—®é¢˜**

**ç—‡çŠ¶**: `network unreachable` æˆ– `timeout`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ç½‘ç»œé…ç½®
ip addr show
ip route show

# 2. æ£€æŸ¥DNSè§£æ
nslookup google.com
cat /etc/resolv.conf

# 3. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo iptables -L
sudo ufw status verbose

# 4. é‡å¯ç½‘ç»œæœåŠ¡
sudo systemctl restart networking

# 5. é‡å¯Dockerç½‘ç»œ
docker network prune
docker-compose -f docker-compose.ubuntu18.yml down
docker-compose -f docker-compose.ubuntu18.yml up -d
```

## ğŸ” **é«˜çº§è°ƒè¯•æŠ€å·§**

### **è¿›å…¥å®¹å™¨è°ƒè¯•**
```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose -f docker-compose.ubuntu18.yml exec backend bash

# è¿›å…¥å‰ç«¯å®¹å™¨
docker-compose -f docker-compose.ubuntu18.yml exec frontend sh

# æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹
docker-compose -f docker-compose.ubuntu18.yml exec backend ps aux

# æŸ¥çœ‹å®¹å™¨å†…ç½‘ç»œ
docker-compose -f docker-compose.ubuntu18.yml exec backend netstat -tuln
```

### **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose -f docker-compose.ubuntu18.yml logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.ubuntu18.yml logs -f backend

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
docker-compose -f docker-compose.ubuntu18.yml logs --tail=100 backend

# æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—
docker-compose -f docker-compose.ubuntu18.yml logs -f -t
```

### **æ€§èƒ½ç›‘æ§**
```bash
# ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# ç›‘æ§ç³»ç»Ÿèµ„æº
htop
iotop
nethogs

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect qa-platform-backend
```

## ğŸ“ **è·å–æŠ€æœ¯æ”¯æŒ**

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æ”¶é›†ä»¥ä¸‹ä¿¡æ¯å¹¶è”ç³»æŠ€æœ¯æ”¯æŒï¼š

### **å¿…é¡»æä¾›çš„ä¿¡æ¯**
```bash
# 1. ç³»ç»Ÿä¿¡æ¯
uname -a > debug-info.txt
cat /etc/os-release >> debug-info.txt

# 2. Dockerä¿¡æ¯
docker --version >> debug-info.txt
docker-compose --version >> debug-info.txt

# 3. å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.ubuntu18.yml ps >> debug-info.txt

# 4. é”™è¯¯æ—¥å¿—
docker-compose -f docker-compose.ubuntu18.yml logs >> debug-info.txt

# 5. ç³»ç»Ÿèµ„æº
free -h >> debug-info.txt
df -h >> debug-info.txt

# 6. ç½‘ç»œçŠ¶æ€
netstat -tuln >> debug-info.txt

# å‘é€ debug-info.txt æ–‡ä»¶
```

### **è”ç³»æ–¹å¼**
- **æŠ€æœ¯æ”¯æŒé‚®ç®±**: tech-support@company.com
- **ç´§æ€¥æŠ€æœ¯çƒ­çº¿**: 400-xxx-xxxx
- **åœ¨çº¿æ–‡æ¡£**: https://docs.qa-platform.com

### **é—®é¢˜æè¿°æ¨¡æ¿**
```
é—®é¢˜æè¿°: [è¯¦ç»†æè¿°é‡åˆ°çš„é—®é¢˜]
é”™è¯¯ä¿¡æ¯: [å®Œæ•´çš„é”™è¯¯ä¿¡æ¯]
æ“ä½œæ­¥éª¤: [å¯¼è‡´é—®é¢˜çš„æ“ä½œæ­¥éª¤]
ç³»ç»Ÿç¯å¢ƒ: [Ubuntuç‰ˆæœ¬ã€Dockerç‰ˆæœ¬ç­‰]
å·²å°è¯•çš„è§£å†³æ–¹æ¡ˆ: [å·²ç»å°è¯•è¿‡çš„æ–¹æ³•]
```

---

## âœ… **é¢„é˜²æ€§ç»´æŠ¤å»ºè®®**

### **å®šæœŸæ£€æŸ¥**
```bash
# æ¯å‘¨æ‰§è¡Œä¸€æ¬¡
./verify-deployment.sh

# æ¯æœˆæ‰§è¡Œä¸€æ¬¡
docker system prune
sudo apt update && sudo apt upgrade
```

### **ç›‘æ§æŒ‡æ ‡**
- CPUä½¿ç”¨ç‡ < 80%
- å†…å­˜ä½¿ç”¨ç‡ < 85%
- ç£ç›˜ä½¿ç”¨ç‡ < 90%
- å®¹å™¨é‡å¯æ¬¡æ•°
- APIå“åº”æ—¶é—´

### **å¤‡ä»½ç­–ç•¥**
```bash
# å¤‡ä»½æ•°æ®åº“
pg_dump -h æ•°æ®åº“åœ°å€ -U ç”¨æˆ·å -d æ•°æ®åº“å > backup_$(date +%Y%m%d).sql

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf config_backup_$(date +%Y%m%d).tar.gz .env docker-compose.ubuntu18.yml

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz uploads/
```
