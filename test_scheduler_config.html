<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒåº¦å™¨é…ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status {
            background-color: #f0f9ff;
        }
        .config {
            background-color: #f0f0f0;
        }
        button {
            background-color: #409EFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #337ecc;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        input, select {
            padding: 5px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è°ƒåº¦å™¨é…ç½®ç®¡ç†æµ‹è¯•</h1>
    
    <div class="section status">
        <h2>ğŸ“Š è°ƒåº¦å™¨çŠ¶æ€</h2>
        <button onclick="getStatus()">è·å–çŠ¶æ€</button>
        <pre id="statusResult">ç‚¹å‡»æŒ‰é’®è·å–çŠ¶æ€...</pre>
    </div>
    
    <div class="section config">
        <h2>âš™ï¸ é…ç½®ç®¡ç†</h2>
        <button onclick="getConfig()">è·å–é…ç½®</button>
        <button onclick="updateConfig()">æ›´æ–°é…ç½®</button>
        <br><br>
        
        <label>
            å¯ç”¨è°ƒåº¦å™¨: 
            <select id="schedulerEnabled">
                <option value="true">æ˜¯</option>
                <option value="false">å¦</option>
            </select>
        </label>
        <br>
        
        <label>
            å·¥ä½œæµé—´éš”(åˆ†é’Ÿ): 
            <input type="number" id="workflowInterval" value="3" min="1" max="60">
        </label>
        <br>
        
        <label>
            æ‰¹å¤„ç†å¤§å°: 
            <input type="number" id="batchSize" value="100" min="1" max="1000">
        </label>
        
        <pre id="configResult">ç‚¹å‡»æŒ‰é’®è·å–é…ç½®...</pre>
    </div>
    
    <div class="section">
        <h2>ğŸ”„ å·¥ä½œæµæ“ä½œ</h2>
        <button onclick="executePhase('data_sync')">æ‰§è¡Œæ•°æ®åŒæ­¥</button>
        <button onclick="executePhase('classification')">æ‰§è¡Œé—®é¢˜åˆ†ç±»</button>
        <button onclick="executePhase('answer_generation')">æ‰§è¡Œç­”æ¡ˆç”Ÿæˆ</button>
        <button onclick="executePhase('scoring')">æ‰§è¡Œè¯„åˆ†å¤„ç†</button>
        <pre id="workflowResult">ç‚¹å‡»æŒ‰é’®æ‰§è¡Œå·¥ä½œæµ...</pre>
    </div>

    <script>
        const API_BASE = '/api/scheduler';
        
        async function apiCall(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                const data = await response.json();
                return data;
            } catch (error) {
                return { success: false, message: error.message };
            }
        }
        
        async function getStatus() {
            const result = await apiCall(`${API_BASE}/status`);
            document.getElementById('statusResult').textContent = JSON.stringify(result, null, 2);
        }
        
        async function getConfig() {
            const result = await apiCall(`${API_BASE}/config`);
            document.getElementById('configResult').textContent = JSON.stringify(result, null, 2);
            
            if (result.success && result.data) {
                // æ›´æ–°è¡¨å•å€¼
                document.getElementById('schedulerEnabled').value = result.data.scheduler_enabled;
                document.getElementById('workflowInterval').value = result.data.workflow_interval_minutes || 3;
                document.getElementById('batchSize').value = result.data.batch_size || 100;
            }
        }
        
        async function updateConfig() {
            const config = {
                scheduler_enabled: document.getElementById('schedulerEnabled').value === 'true',
                workflow_interval_minutes: parseInt(document.getElementById('workflowInterval').value),
                batch_size: parseInt(document.getElementById('batchSize').value)
            };
            
            const result = await apiCall(`${API_BASE}/config`, {
                method: 'PUT',
                body: JSON.stringify(config)
            });
            
            document.getElementById('configResult').textContent = JSON.stringify(result, null, 2);
        }
        
        async function executePhase(phase) {
            const result = await apiCall(`${API_BASE}/workflow/phase/${phase}`, {
                method: 'POST'
            });
            
            document.getElementById('workflowResult').textContent = JSON.stringify(result, null, 2);
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–åˆå§‹çŠ¶æ€
        window.onload = function() {
            getStatus();
            getConfig();
        };
    </script>
</body>
</html>
