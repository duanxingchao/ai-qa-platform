# AIé—®ç­”å¹³å°é¡¹ç›®éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æœ¬æŒ‡å—é€‚ç”¨äºåœ¨å…¬å¸å†…ç½‘UbuntuæœåŠ¡å™¨ä¸Šéƒ¨ç½²AIé—®ç­”å¹³å°ï¼Œé›†æˆè£è€€å†…éƒ¨APIå’Œé«˜æ–¯æ•°æ®åº“ã€‚

### ğŸ¯ éƒ¨ç½²ç›®æ ‡
- éƒ¨ç½²å®Œæ•´çš„AIé—®ç­”å¹³å°ï¼ˆå‰ç«¯+åç«¯ï¼‰
- é›†æˆè£è€€åˆ†ç±»APIå’Œè¯„åˆ†API
- è¿æ¥é«˜æ–¯æ•°æ®åº“ï¼ˆdm_rnd_xa_export schemaï¼‰
- é…ç½®å†…ç½‘ä»£ç†ç¯å¢ƒ
- ä½¿ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²

---

## âœ… å·²å®Œæˆçš„ä»£ç é…ç½®

### **APIé…ç½®**
- **åˆ†ç±»APIåœ°å€**: `http://aipipeline.ipd.hihonor.com/v1/workflows/run`
- **åˆ†ç±»APIå¯†é’¥**: `app-mw]Eht3zDaKUĞ—LAa6T9XKwu`
- **è¯„åˆ†APIåœ°å€**: `http://aipipeline.ipd.hihonor.com/v1/workflows/run`
- **è¯„åˆ†APIå¯†é’¥**: `app-SXgaGHIf25NtJXEFmc9ecRSc`

### **æ•°æ®åº“é…ç½®**
- **æ•°æ®åº“ç±»å‹**: é«˜æ–¯æ•°æ®åº“
- **æ•°æ®åº“ç”¨æˆ·**: `dmp_rnd_xa`
- **æ•°æ®åº“ç«¯å£**: `8000`
- **æ•°æ®åº“å**: `datalake`
- **Schema**: `dm_rnd_xa_export`
- **æºè¡¨**: `mid_pc_yoyo_qa_641000052`

### **Gitæäº¤çŠ¶æ€**
- **æœ€æ–°æäº¤**: `96e0ba0 feat: æ›´æ–°è£è€€APIå®Œæ•´é…ç½®`
- **çŠ¶æ€**: æ‰€æœ‰é…ç½®å·²æ›´æ–°å¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡æ¸…å•

### **éœ€è¦æ‚¨å‡†å¤‡çš„ä¿¡æ¯**
| é¡¹ç›® | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| ä»£ç†æœåŠ¡å™¨åœ°å€ | `http://proxy.company.com:8080` | ç”¨äºè®¿é—®å¤–ç½‘ä¸‹è½½ä¾èµ– |
| æ•°æ®åº“ä¸»æœºåœ°å€ | `db.company.com` æˆ– `192.168.1.100` | é«˜æ–¯æ•°æ®åº“æœåŠ¡å™¨åœ°å€ |
| æ•°æ®åº“å¯†ç  | `æ‚¨çš„dmp_rnd_xaå¯†ç ` | æ•°æ®åº“ç”¨æˆ·å¯†ç  |

### **ç¯å¢ƒè¦æ±‚**
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 18.04+
- **æƒé™**: sudoæƒé™
- **ç«¯å£**: 18080ï¼ˆå‰ç«¯ï¼‰ã€8088ï¼ˆåç«¯ï¼‰å¯ç”¨
- **ç½‘ç»œ**: èƒ½è®¿é—®ä»£ç†æœåŠ¡å™¨å’Œå†…ç½‘æ•°æ®åº“

---

## ğŸš€ è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### **æ­¥éª¤1: åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆå®‰å…¨æœ€ä½³å®è·µï¼‰**
```bash
# 1.1 åˆ›å»ºåº”ç”¨ä¸“ç”¨ç”¨æˆ·
sudo useradd -m -s /bin/bash qaplatform

# 1.2 æ·»åŠ ç”¨æˆ·åˆ°dockerç»„
sudo usermod -aG docker qaplatform

# 1.3 é…ç½®å¿…è¦çš„sudoæƒé™
echo "qaplatform ALL=(ALL) NOPASSWD: /usr/bin/docker, /usr/bin/docker-compose, /usr/bin/systemctl" | sudo tee /etc/sudoers.d/qaplatform

# 1.4 åˆ‡æ¢åˆ°ä¸“ç”¨ç”¨æˆ·
sudo su - qaplatform

# 1.5 éªŒè¯ç”¨æˆ·ç¯å¢ƒ
whoami
pwd  # åº”è¯¥åœ¨ /home/qaplatform
```

### **æ­¥éª¤2: è·å–é¡¹ç›®ä»£ç **
```bash
# 2.1 å…‹éš†é¡¹ç›®ä»£ç 
git clone https://github.com/duanxingchao/ai-qa-platform.git

# 2.2 è¿›å…¥é¡¹ç›®ç›®å½•
cd ai-qa-platform

# 2.3 ç¡®è®¤ç‰ˆæœ¬
git log --oneline -3
# åº”è¯¥çœ‹åˆ°: 96e0ba0 feat: æ›´æ–°è£è€€APIå®Œæ•´é…ç½®

# 2.4 æ£€æŸ¥éƒ¨ç½²è„šæœ¬
ls -la quick-deploy-with-proxy.sh
```

### **æ­¥éª¤3: é…ç½®éƒ¨ç½²å‚æ•°**
```bash
# 3.1 æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼ˆå·²é¢„é…ç½®è£è€€ç¯å¢ƒï¼‰
cat deploy-config.sh

# é…ç½®æ–‡ä»¶å†…å®¹ï¼š
# HTTP_PROXY="http://proxyssx.his.hihonor.com:8080"
# HTTPS_PROXY="http://proxyssx.his.hihonor.com:8080"
# FTP_PROXY="http://proxyssx.his.hihonor.com:8080"
# NO_PROXY="localhost,127.0.0.1,w3.hihonor.com,mgf-tm.ipd.hihonor.com,mirrors.chinatelecom.hihonor.io"
# DB_HOST="dws-digital-datalake.digital.hihonor.com"
# DB_PORT="8000"
# DB_USER="dmp_rnd_xa"
# DB_NAME="éœ€è¦åœ¨è¿è¡Œæ—¶è¾“å…¥"
# DB_PASSWORD="éœ€è¦åœ¨è¿è¡Œæ—¶è¾“å…¥"
# USE_GLORY_API="y"
```

### **æ­¥éª¤4: ä¸€é”®è‡ªåŠ¨éƒ¨ç½²**
```bash
# 4.1 ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x quick-deploy-with-proxy.sh

# 4.2 è¿è¡Œè‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼ˆä»…éœ€è¾“å…¥æ•°æ®åº“åå’Œå¯†ç ï¼‰
./quick-deploy-with-proxy.sh

# è„šæœ¬è¿è¡Œæ—¶ä¼šæç¤ºï¼š
# è¯·è¾“å…¥æ•°æ®åº“åç§°: [è¾“å…¥æ‚¨çš„æ•°æ®åº“å]
# è¯·è¾“å…¥æ•°æ®åº“å¯†ç : [è¾“å…¥å¯†ç ï¼Œä¸ä¼šæ˜¾ç¤º]
```

### **æ­¥éª¤5: è‡ªåŠ¨åŒ–æ‰§è¡Œè¿‡ç¨‹**
è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
```
1. âœ… æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ (Ubuntuç‰ˆæœ¬ã€æƒé™ç­‰)
2. âœ… é…ç½®ç³»ç»Ÿä»£ç†ç¯å¢ƒå˜é‡
3. âœ… å®‰è£…Dockerå’ŒDocker Compose
4. âœ… é…ç½®Dockerä»£ç†è®¾ç½®
5. âœ… ç”Ÿæˆæ•°æ®åº“è¿æ¥é…ç½®
6. âœ… ç”Ÿæˆè£è€€APIé…ç½®æ–‡ä»¶
7. âœ… æ„å»ºå’Œå¯åŠ¨DockeræœåŠ¡
8. âœ… éªŒè¯æœåŠ¡çŠ¶æ€
9. âœ… æµ‹è¯•æ•°æ®åº“è¿æ¥
10. âœ… æµ‹è¯•è£è€€åˆ†ç±»APIè¿æ¥
11. âœ… æµ‹è¯•è£è€€è¯„åˆ†APIè¿æ¥
```

### **æ­¥éª¤6: éƒ¨ç½²å®ŒæˆéªŒè¯**
éƒ¨ç½²æˆåŠŸåä¼šæ˜¾ç¤ºï¼š
```
ğŸ‰ éƒ¨ç½²å®Œæˆï¼

ğŸ“Š æœåŠ¡çŠ¶æ€:
âœ… åç«¯æœåŠ¡: è¿è¡Œä¸­
âœ… å‰ç«¯æœåŠ¡: è¿è¡Œä¸­  
âœ… æ•°æ®åº“è¿æ¥: æ­£å¸¸
âœ… è£è€€åˆ†ç±»APIè¿æ¥: æ­£å¸¸ (app-mw]Eht3zDaKUĞ—LAa6T9XKwu)
âœ… è£è€€è¯„åˆ†APIè¿æ¥: æ­£å¸¸ (app-SXgaGHIf25NtJXEFmc9ecRSc)

ğŸŒ è®¿é—®åœ°å€:
å‰ç«¯: http://æœåŠ¡å™¨IP:18080
åç«¯API: http://æœåŠ¡å™¨IP:8088/api
å¥åº·æ£€æŸ¥: http://æœåŠ¡å™¨IP:8088/api/health

ğŸ”§ ç®¡ç†å‘½ä»¤:
æŸ¥çœ‹çŠ¶æ€: docker-compose -f docker-compose.ubuntu18.yml ps
æŸ¥çœ‹æ—¥å¿—: docker-compose -f docker-compose.ubuntu18.yml logs -f
é‡å¯æœåŠ¡: docker-compose -f docker-compose.ubuntu18.yml restart
```

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### **æœåŠ¡ç®¡ç†**
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.ubuntu18.yml ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.ubuntu18.yml logs -f

# é‡å¯æœåŠ¡
docker-compose -f docker-compose.ubuntu18.yml restart

# åœæ­¢æœåŠ¡
docker-compose -f docker-compose.ubuntu18.yml down

# å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.ubuntu18.yml up -d
```

### **å¥åº·æ£€æŸ¥**
```bash
# æ£€æŸ¥åç«¯API
curl http://localhost:8088/api/health

# æ£€æŸ¥å‰ç«¯é¡µé¢
curl -I http://localhost:18080

# æµ‹è¯•è£è€€APIè¿æ¥
docker-compose -f docker-compose.ubuntu18.yml exec backend python test_honor_api_integration.py
```

### **æ•°æ®åº“æ“ä½œ**
```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose -f docker-compose.ubuntu18.yml exec backend bash

# åœ¨å®¹å™¨å†…è¿æ¥æ•°æ®åº“
python -c "
from app import create_app, db
app = create_app()
with app.app_context():
    # æµ‹è¯•æ•°æ®åº“è¿æ¥
    result = db.engine.execute('SELECT 1')
    print('æ•°æ®åº“è¿æ¥æ­£å¸¸')
"
```

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### **å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**

#### **1. Gitå…‹éš†å¤±è´¥**
```bash
# é—®é¢˜: æ–‡ä»¶å¤¹ä¸ºç©ºæˆ–å…‹éš†å¤±è´¥
# è§£å†³æ–¹æ¡ˆ:
# 1) æ£€æŸ¥ä»£ç†é…ç½®
echo $http_proxy
echo $https_proxy

# 2) é‡æ–°é…ç½®Gitä»£ç†
git config --global http.proxy http://æ‚¨çš„ä»£ç†åœ°å€:ç«¯å£
git config --global https.proxy http://æ‚¨çš„ä»£ç†åœ°å€:ç«¯å£

# 3) æµ‹è¯•ç½‘ç»œè¿æ¥
ping github.com
curl -I https://github.com

# 4) å¤‡ç”¨æ–¹æ¡ˆï¼šæ‰‹åŠ¨ä¸‹è½½
wget https://github.com/duanxingchao/ai-qa-platform/archive/refs/heads/master.zip
unzip master.zip
mv ai-qa-platform-master ai-qa-platform
```

#### **2. DockeræœåŠ¡å¯åŠ¨å¤±è´¥**
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose -f docker-compose.ubuntu18.yml logs

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E "(18080|8088)"

# é‡æ–°æ„å»ºé•œåƒ
docker-compose -f docker-compose.ubuntu18.yml build --no-cache
```

#### **3. æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥æ•°æ®åº“é…ç½®
cat .env | grep DATABASE

# æµ‹è¯•æ•°æ®åº“è¿æ¥
telnet æ•°æ®åº“ä¸»æœº 8000

# æ£€æŸ¥Schemaæƒé™
# ç¡®ä¿dmp_rnd_xaç”¨æˆ·å¯¹dm_rnd_xa_export schemaæœ‰å®Œæ•´æƒé™
```

#### **4. è£è€€APIè¿æ¥å¤±è´¥**
```bash
# æµ‹è¯•APIè¿é€šæ€§
curl -X POST http://aipipeline.ipd.hihonor.com/v1/workflows/run \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer app-mw]Eht3zDaKUĞ—LAa6T9XKwu" \
  -d '{"inputs":{"QUERY":"æµ‹è¯•"},"response_mode":"blocking","user":"00031559"}'

# æ£€æŸ¥APIé…ç½®
cat .env | grep -E "(CLASSIFY_API|SCORE_API)"
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### **æ—¥å¸¸ç»´æŠ¤**
- **ç›‘æ§æœåŠ¡çŠ¶æ€**: å®šæœŸæ£€æŸ¥Dockerå®¹å™¨è¿è¡ŒçŠ¶æ€
- **æŸ¥çœ‹æ—¥å¿—**: ç›‘æ§åº”ç”¨æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- **æ•°æ®å¤‡ä»½**: å®šæœŸå¤‡ä»½æ•°æ®åº“æ•°æ®
- **æ€§èƒ½ç›‘æ§**: ç›‘æ§CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ

### **è”ç³»æ–¹å¼**
å¦‚é‡åˆ°æŠ€æœ¯é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. é”™è¯¯æ—¥å¿—å†…å®¹
2. ç³»ç»Ÿç¯å¢ƒä¿¡æ¯
3. éƒ¨ç½²æ­¥éª¤æ‰§è¡Œæƒ…å†µ
4. ç½‘ç»œå’Œä»£ç†é…ç½®

---

## ğŸ¯ éƒ¨ç½²æ€»ç»“

**é¢„è®¡éƒ¨ç½²æ—¶é—´**: 15-30åˆ†é’Ÿ
**æœåŠ¡ç«¯å£**: å‰ç«¯18080ï¼Œåç«¯8088
**è®¿é—®æ–¹å¼**: æµè§ˆå™¨è®¿é—® `http://æœåŠ¡å™¨IP:18080`

**å…³é”®æˆåŠŸå› ç´ **:
1. âœ… æ­£ç¡®é…ç½®ä»£ç†ç¯å¢ƒ
2. âœ… å‡†ç¡®è¾“å…¥æ•°æ®åº“è¿æ¥ä¿¡æ¯
3. âœ… ç¡®ä¿ç«¯å£æœªè¢«å ç”¨
4. âœ… ç½‘ç»œè¿é€šæ€§æ­£å¸¸

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„AIé—®ç­”å¹³å°ï¼Œæ”¯æŒé—®é¢˜åˆ†ç±»ã€ç­”æ¡ˆç”Ÿæˆå’Œæ™ºèƒ½è¯„åˆ†åŠŸèƒ½ï¼ğŸ‰
