# ğŸ¤– AIé—®ç­”å¹³å°è‡ªåŠ¨åŒ–å·¥ä½œæµä½¿ç”¨è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ç°åœ¨AIé—®ç­”å¹³å°å·²ç»å®ç°äº†å®Œæ•´çš„è‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

- âœ… **å¯åŠ¨æ—¶ç«‹å³å¤„ç†**ï¼šåç«¯å¯åŠ¨åè‡ªåŠ¨å¤„ç†å·²æœ‰æ•°æ®
- âœ… **æ™ºèƒ½æ•°æ®æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹æ˜¯å¦æœ‰å¾…å¤„ç†æ•°æ®
- âœ… **æ— æ•°æ®æŒ‚èµ·**ï¼šæ²¡æœ‰æ•°æ®æ—¶è‡ªåŠ¨æŒ‚èµ·ï¼ŒèŠ‚çœèµ„æº
- âœ… **å¯é…ç½®é—´éš”**ï¼šè°ƒåº¦é—´éš”å¯é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼ˆé»˜è®¤3åˆ†é’Ÿï¼‰
- âœ… **å…¨é“¾è·¯è‡ªåŠ¨åŒ–**ï¼šæ•°æ®æ’å…¥â†’åŒæ­¥â†’åˆ†ç±»â†’ç­”æ¡ˆç”Ÿæˆâ†’è¯„åˆ†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨MockæœåŠ¡
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
./start_mock_services.sh

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯åŠ¨
cd backend/tests
python mock_classification_api.py --port 8001 &
python mock_ai_api.py --service doubao --port 8002 &
python mock_ai_api.py --service xiaotian --port 8003 &
python mock_score_api.py --port 8004 &
```

### 2. å¯åŠ¨åç«¯æœåŠ¡
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬
./start_backend.sh

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯åŠ¨
cd backend
source venv/bin/activate
python run.py
```

### 3. éªŒè¯è‡ªåŠ¨åŒ–åŠŸèƒ½
```bash
# è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
cd backend
source venv/bin/activate
python test_auto_workflow.py
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# è®¾ç½®å·¥ä½œæµæ‰§è¡Œé—´éš”ï¼ˆåˆ†é’Ÿï¼‰
export WORKFLOW_INTERVAL_MINUTES=3

# å¯ç”¨/ç¦ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨å¤„ç†
export AUTO_PROCESS_ON_STARTUP=true

# å¯ç”¨/ç¦ç”¨æ•°æ®æ£€æµ‹
export DATA_CHECK_ENABLED=true
```

### åº”ç”¨é…ç½®
åœ¨ `backend/app/config.py` ä¸­å¯ä»¥ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```python
# è‡ªåŠ¨åŒ–å¤„ç†é…ç½®
AUTO_PROCESS_ON_STARTUP = True          # å¯åŠ¨æ—¶ç«‹å³å¤„ç†
WORKFLOW_INTERVAL_MINUTES = 3           # è°ƒåº¦é—´éš”ï¼ˆåˆ†é’Ÿï¼‰
DATA_CHECK_ENABLED = True               # æ•°æ®æ£€æµ‹å¼€å…³
AUTO_SUSPEND_WHEN_NO_DATA = True        # æ— æ•°æ®æŒ‚èµ·å¼€å…³
MIN_BATCH_SIZE = 1                      # æœ€å°æ‰¹å¤„ç†å¤§å°
```

## ğŸ“Š ç›‘æ§å’Œç®¡ç†

### APIç«¯ç‚¹

#### 1. è°ƒåº¦å™¨çŠ¶æ€
```bash
# è·å–è°ƒåº¦å™¨çŠ¶æ€
curl http://localhost:8088/api/scheduler/status

# æ‰‹åŠ¨æ‰§è¡Œå·¥ä½œæµ
curl -X POST http://localhost:8088/api/scheduler/manual/workflow

# æ‰‹åŠ¨æ‰§è¡Œç‰¹å®šé˜¶æ®µ
curl -X POST http://localhost:8088/api/scheduler/manual/sync
curl -X POST http://localhost:8088/api/scheduler/manual/classify
curl -X POST http://localhost:8088/api/scheduler/manual/generate
curl -X POST http://localhost:8088/api/scheduler/manual/score
```

#### 2. MockæœåŠ¡ç®¡ç†
```bash
# æ£€æŸ¥æ‰€æœ‰MockæœåŠ¡çŠ¶æ€
curl http://localhost:8088/api/mock/status

# æ£€æŸ¥å•ä¸ªæœåŠ¡çŠ¶æ€
curl http://localhost:8088/api/mock/status/doubao

# è·å–å¯åŠ¨å‘½ä»¤
curl http://localhost:8088/api/mock/startup-commands

# è·å–å¯åŠ¨è„šæœ¬
curl http://localhost:8088/api/mock/startup-script
```

#### 3. æ•°æ®å¤„ç†çŠ¶æ€
```bash
# æ•°æ®åŒæ­¥çŠ¶æ€
curl http://localhost:8088/api/sync/status

# å¤„ç†ç»Ÿè®¡
curl http://localhost:8088/api/process/statistics

# æ•°æ®å¤§ç›˜
curl http://localhost:8088/api/dashboard
```

## ğŸ”„ å·¥ä½œæµè¯´æ˜

### æ‰§è¡Œæµç¨‹
```mermaid
graph LR
    A[åç«¯å¯åŠ¨] --> B[ç«‹å³å¤„ç†å·²æœ‰æ•°æ®]
    B --> C[å®šæ—¶æ£€æµ‹æ–°æ•°æ®]
    C --> D{æœ‰å¾…å¤„ç†æ•°æ®?}
    D -->|æ˜¯| E[æ‰§è¡Œå®Œæ•´å·¥ä½œæµ]
    D -->|å¦| F[æŒ‚èµ·ç­‰å¾…]
    E --> G[æ•°æ®åŒæ­¥]
    G --> H[é—®é¢˜åˆ†ç±»]
    H --> I[ç­”æ¡ˆç”Ÿæˆ]
    I --> J[ç­”æ¡ˆè¯„åˆ†]
    J --> C
    F --> C
```

### å„é˜¶æ®µè¯´æ˜

1. **æ•°æ®åŒæ­¥é˜¶æ®µ**
   - ä»table1å¢é‡åŒæ­¥æ•°æ®åˆ°questions/answersè¡¨
   - è‡ªåŠ¨å»é‡ï¼ŒåŸºäºMD5ä¸šåŠ¡ä¸»é”®
   - è¿‡æ»¤æ— æ•ˆæ•°æ®ï¼ˆqueryä¸ºç©ºç­‰ï¼‰

2. **é—®é¢˜åˆ†ç±»é˜¶æ®µ**
   - è°ƒç”¨åˆ†ç±»APIå¯¹é—®é¢˜è¿›è¡Œ16é¢†åŸŸåˆ†ç±»
   - æ”¯æŒæ‰¹é‡å¤„ç†ï¼Œæé«˜æ•ˆç‡
   - å¤±è´¥é‡è¯•æœºåˆ¶

3. **ç­”æ¡ˆç”Ÿæˆé˜¶æ®µ**
   - å¹¶å‘è°ƒç”¨è±†åŒ…ã€å°å¤©AI API
   - ä¸ºæ¯ä¸ªé—®é¢˜ç”Ÿæˆå¤šç§AIç­”æ¡ˆ
   - ç­”æ¡ˆå…³è”åˆ°å¯¹åº”é—®é¢˜

4. **ç­”æ¡ˆè¯„åˆ†é˜¶æ®µ**
   - è°ƒç”¨è¯„åˆ†APIè¿›è¡Œäº”ç»´è¯„åˆ†
   - æ”¯æŒåŠ¨æ€è¯„åˆ†ç»´åº¦åç§°
   - è®¡ç®—ç»¼åˆè¯„åˆ†

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### 1. è‡ªåŠ¨åŒ–æµ‹è¯•
```bash
cd backend
source venv/bin/activate
python test_auto_workflow.py
```

æµ‹è¯•å†…å®¹åŒ…æ‹¬ï¼š
- âœ… é…ç½®æ£€æŸ¥ï¼šéªŒè¯é…ç½®é¡¹æ­£ç¡®æ€§
- âœ… æŒ‚èµ·æœºåˆ¶ï¼šéªŒè¯æ— æ•°æ®æ—¶çš„æŒ‚èµ·åŠŸèƒ½
- âœ… å¯åŠ¨æ—¶å¤„ç†ï¼šéªŒè¯å¯åŠ¨æ—¶ç«‹å³å¤„ç†åŠŸèƒ½
- âœ… æ–°æ•°æ®å¤„ç†ï¼šéªŒè¯æ–°æ•°æ®æ’å…¥åçš„è‡ªåŠ¨å¤„ç†

### 2. æ‰‹åŠ¨æµ‹è¯•
```bash
# 1. æ’å…¥æµ‹è¯•æ•°æ®åˆ°table1
cd backend
source venv/bin/activate
python tests/mock_data_manager.py --action add_data --count 5

# 2. è§‚å¯Ÿè‡ªåŠ¨å¤„ç†è¿‡ç¨‹
tail -f app.log

# 3. æ£€æŸ¥å¤„ç†ç»“æœ
python -c "
from app import create_app
from app.models import Question, Answer, Score
app = create_app()
with app.app_context():
    print(f'Questions: {Question.query.count()}')
    print(f'Answers: {Answer.query.count()}')
    print(f'Scores: {Score.query.count()}')
"
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ‰¹å¤„ç†é…ç½®
```python
# è°ƒæ•´æ‰¹å¤„ç†å¤§å°
BATCH_SIZE = 100  # æ¯æ‰¹å¤„ç†çš„è®°å½•æ•°

# è°ƒæ•´æœ€å°æ‰¹å¤„ç†é˜ˆå€¼
MIN_BATCH_SIZE = 1  # å°äºæ­¤æ•°é‡æ—¶æŒ‚èµ·
```

### è°ƒåº¦ä¼˜åŒ–
```bash
# è°ƒæ•´è°ƒåº¦é—´éš”ï¼ˆæ ¹æ®æ•°æ®é‡å’Œå¤„ç†èƒ½åŠ›ï¼‰
export WORKFLOW_INTERVAL_MINUTES=5  # 5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
```

### APIè¶…æ—¶é…ç½®
```python
# APIè°ƒç”¨è¶…æ—¶è®¾ç½®
API_TIMEOUT = 30          # APIè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
API_RETRY_TIMES = 3       # é‡è¯•æ¬¡æ•°
API_RETRY_DELAY = 1.0     # é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. MockæœåŠ¡æ— æ³•è¿æ¥
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:8001/health
curl http://localhost:8002/health
curl http://localhost:8003/health
curl http://localhost:8004/health

# é‡æ–°å¯åŠ¨MockæœåŠ¡
./start_mock_services.sh
```

#### 2. å·¥ä½œæµæ‰§è¡Œå¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f backend/app.log

# æ£€æŸ¥è°ƒåº¦å™¨çŠ¶æ€
curl http://localhost:8088/api/scheduler/status

# æ‰‹åŠ¨æ‰§è¡Œç‰¹å®šé˜¶æ®µ
curl -X POST http://localhost:8088/api/scheduler/manual/sync
```

#### 3. æ•°æ®å¤„ç†åœæ»
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
python -c "
from app import create_app
from app.utils.database import db
app = create_app()
with app.app_context():
    db.session.execute('SELECT 1')
    print('æ•°æ®åº“è¿æ¥æ­£å¸¸')
"

# æ£€æŸ¥table1æ•°æ®
python -c "
import psycopg2
conn = psycopg2.connect(
    host='test-huiliu-postgresql.ns-q8rah3y5.svc',
    port=5432, user='postgres', password='l69jjd9n',
    database='ai_qa_platform'
)
cursor = conn.cursor()
cursor.execute('SELECT COUNT(*) FROM table1')
print(f'table1æ€»è®°å½•æ•°: {cursor.fetchone()[0]}')
conn.close()
"
```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
grep -i "å¯åŠ¨æ—¶ç«‹å³å¤„ç†" backend/app.log

# æŸ¥çœ‹å·¥ä½œæµæ‰§è¡Œæ—¥å¿—
grep -i "å·¥ä½œæµ" backend/app.log

# æŸ¥çœ‹æŒ‚èµ·æ—¥å¿—
grep -i "æŒ‚èµ·" backend/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep -i "error\|failed\|å¼‚å¸¸" backend/app.log
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›‘æ§æŒ‡æ ‡
- ğŸ“Š æ•°æ®å¤„ç†é‡ï¼šquestionsã€answersã€scoresè¡¨è®°å½•æ•°
- â±ï¸ å¤„ç†æ—¶å»¶ï¼šä»æ•°æ®æ’å…¥åˆ°å®Œæˆè¯„åˆ†çš„æ—¶é—´
- ğŸ”„ è°ƒåº¦é¢‘ç‡ï¼šå·¥ä½œæµæ‰§è¡Œé¢‘ç‡å’ŒæˆåŠŸç‡
- ğŸ’¾ èµ„æºä½¿ç”¨ï¼šCPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ

### å…³é”®API
- **è°ƒåº¦å™¨ç®¡ç†**ï¼š`/api/scheduler/*`
- **MockæœåŠ¡ç®¡ç†**ï¼š`/api/mock/*`
- **æ•°æ®åŒæ­¥**ï¼š`/api/sync/*`
- **å¤„ç†ç»Ÿè®¡**ï¼š`/api/process/*`
- **æ•°æ®å¤§ç›˜**ï¼š`/api/dashboard`

### é…ç½®æ–‡ä»¶
- **ä¸»é…ç½®**ï¼š`backend/app/config.py`
- **ç¯å¢ƒå˜é‡**ï¼š`.env` æ–‡ä»¶
- **å¯åŠ¨è„šæœ¬**ï¼š`start_backend.sh`ã€`start_mock_services.sh`

---

**ğŸ‰ è‡³æ­¤ï¼ŒAIé—®ç­”å¹³å°å·²å®ç°å®Œæ•´çš„è‡ªåŠ¨åŒ–å·¥ä½œæµï¼**

åªéœ€å¯åŠ¨åç«¯æœåŠ¡å’ŒMockæœåŠ¡ï¼Œç³»ç»Ÿå°±ä¼šï¼š
1. ç«‹å³å¤„ç†å·²æœ‰æ•°æ®
2. å®šæ—¶æ£€æµ‹æ–°æ•°æ®
3. è‡ªåŠ¨æ‰§è¡Œå®Œæ•´å¤„ç†é“¾è·¯
4. æ™ºèƒ½æŒ‚èµ·ç­‰å¾…æ–°æ•°æ®

å½“æ‚¨å¾€table1æ’å…¥æ–°æ•°æ®æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨ä¸‹ä¸ªè°ƒåº¦å‘¨æœŸï¼ˆé»˜è®¤3åˆ†é’Ÿï¼‰è‡ªåŠ¨æ£€æµ‹å¹¶å¤„ç†è¿™äº›æ•°æ®ã€‚ 