# ç”Ÿäº§ç¯å¢ƒè¯¦ç»†éƒ¨ç½²æ‰‹å†Œ - è£è€€APIç‰ˆ

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æœ¬æ‰‹å†Œæä¾›åœ¨å…¬å¸ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²AIé—®ç­”å¹³å°çš„è¯¦ç»†æ­¥éª¤ï¼ŒåŒ…å«æ¯ä¸€æ­¥çš„å…·ä½“æ“ä½œå’Œé¢„æœŸæ•ˆæœã€‚

### ğŸ¯ éƒ¨ç½²ç›®æ ‡
- éƒ¨ç½²å®Œæ•´çš„AIé—®ç­”å¹³å°
- é›†æˆè£è€€åˆ†ç±»APIå’Œè¯„åˆ†API
- é…ç½®æ•°æ®åº“å’Œåç«¯æœåŠ¡
- éƒ¨ç½²å‰ç«¯ç•Œé¢
- éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ

### ğŸ“Š ç³»ç»Ÿæ¶æ„
```
[å‰ç«¯Vue.js] â†’ [Nginx] â†’ [åç«¯Flask] â†’ [è£è€€API] â†’ [PostgreSQL]
     â†“           â†“          â†“           â†“           â†“
   ç”¨æˆ·ç•Œé¢    åå‘ä»£ç†   ä¸šåŠ¡é€»è¾‘   AIåˆ†ç±»è¯„åˆ†   æ•°æ®å­˜å‚¨
```

---

## ğŸ”§ ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒå‡†å¤‡

### 1.1 æœåŠ¡å™¨è¦æ±‚æ£€æŸ¥

#### æ“ä½œæ­¥éª¤
```bash
# æ£€æŸ¥æ“ä½œç³»ç»Ÿç‰ˆæœ¬
cat /etc/os-release

# æ£€æŸ¥CPUå’Œå†…å­˜
lscpu | grep "CPU(s)"
free -h

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping -c 3 aipipeline.ipd.hihonor.com
```

#### é¢„æœŸæ•ˆæœ
```
âœ… æ“ä½œç³»ç»Ÿ: Ubuntu 18.04+ æˆ– CentOS 7+
âœ… CPU: 4æ ¸å¿ƒä»¥ä¸Š
âœ… å†…å­˜: 8GBä»¥ä¸Š
âœ… ç£ç›˜: 50GBä»¥ä¸Šå¯ç”¨ç©ºé—´
âœ… ç½‘ç»œ: èƒ½å¤Ÿè®¿é—®è£è€€å†…éƒ¨API (pingæˆåŠŸ)
```

### 1.2 å®‰è£…åŸºç¡€è½¯ä»¶

#### æ“ä½œæ­¥éª¤
```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt update && sudo apt upgrade -y

# å®‰è£…Python 3.8+
sudo apt install python3 python3-pip python3-venv -y

# å®‰è£…Node.js 16+
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt install nodejs -y

# å®‰è£…PostgreSQL
sudo apt install postgresql postgresql-contrib -y

# å®‰è£…Git
sudo apt install git -y

# å®‰è£…Nginx
sudo apt install nginx -y

# å®‰è£…å…¶ä»–å·¥å…·
sudo apt install curl jq htop vim -y
```

#### é¢„æœŸæ•ˆæœ
```bash
# éªŒè¯å®‰è£…
python3 --version    # åº”æ˜¾ç¤º Python 3.8.x æˆ–æ›´é«˜
node --version       # åº”æ˜¾ç¤º v16.x.x æˆ–æ›´é«˜
npm --version        # åº”æ˜¾ç¤º 8.x.x æˆ–æ›´é«˜
psql --version       # åº”æ˜¾ç¤º PostgreSQL 12.x æˆ–æ›´é«˜
git --version        # åº”æ˜¾ç¤º git version 2.x.x
nginx -v             # åº”æ˜¾ç¤º nginx version 1.x.x
```

### 1.3 åˆ›å»ºéƒ¨ç½²ç”¨æˆ·

#### æ“ä½œæ­¥éª¤
```bash
# åˆ›å»ºéƒ¨ç½²ç”¨æˆ·
sudo useradd -m -s /bin/bash aiqa
sudo usermod -aG sudo aiqa

# è®¾ç½®å¯†ç 
sudo passwd aiqa

# åˆ‡æ¢åˆ°éƒ¨ç½²ç”¨æˆ·
sudo su - aiqa

# éªŒè¯å½“å‰ç”¨æˆ·
whoami
pwd
```

#### é¢„æœŸæ•ˆæœ
```
âœ… ç”¨æˆ·aiqaåˆ›å»ºæˆåŠŸ
âœ… ç”¨æˆ·å…·æœ‰sudoæƒé™
âœ… å½“å‰ç”¨æˆ·: aiqa
âœ… å½“å‰å·¥ä½œç›®å½•: /home/aiqa
```

---

## ğŸ—„ï¸ ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åº“é…ç½®

### 2.1 é…ç½®PostgreSQL

#### æ“ä½œæ­¥éª¤
```bash
# å¯åŠ¨PostgreSQLæœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql

# éªŒè¯æœåŠ¡çŠ¶æ€
sudo systemctl status postgresql

# åˆ‡æ¢åˆ°postgresç”¨æˆ·
sudo su - postgres

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
psql -c "CREATE DATABASE aiqa_production;"
psql -c "CREATE USER aiqa_user WITH PASSWORD 'AiQa2024#Prod';"
psql -c "GRANT ALL PRIVILEGES ON DATABASE aiqa_production TO aiqa_user;"
psql -c "ALTER USER aiqa_user CREATEDB;"

# éªŒè¯åˆ›å»ºç»“æœ
psql -c "\l" | grep aiqa_production
psql -c "\du" | grep aiqa_user

# é€€å‡ºpostgresç”¨æˆ·
exit
```

#### é¢„æœŸæ•ˆæœ
```bash
# PostgreSQLæœåŠ¡çŠ¶æ€
â— postgresql.service - PostgreSQL RDBMS
   Loaded: loaded
   Active: active (running)

# æ•°æ®åº“åˆ›å»ºéªŒè¯
aiqa_production | aiqa_user | UTF8

# ç”¨æˆ·åˆ›å»ºéªŒè¯
aiqa_user | Create DB
```

### 2.2 é…ç½®æ•°æ®åº“è¿æ¥

#### æ“ä½œæ­¥éª¤
```bash
# ç¼–è¾‘PostgreSQLé…ç½®
sudo nano /etc/postgresql/12/main/postgresql.conf

# ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼ˆæ‰¾åˆ°å¯¹åº”è¡Œå¹¶ä¿®æ”¹ï¼‰
listen_addresses = 'localhost'
port = 5432

# ç¼–è¾‘è®¿é—®æ§åˆ¶
sudo nano /etc/postgresql/12/main/pg_hba.conf

# åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œ
local   aiqa_production   aiqa_user                     md5
host    aiqa_production   aiqa_user   127.0.0.1/32      md5

# é‡å¯PostgreSQL
sudo systemctl restart postgresql

# éªŒè¯é‡å¯çŠ¶æ€
sudo systemctl status postgresql
```

#### é¢„æœŸæ•ˆæœ
```bash
# éªŒè¯é…ç½®
sudo systemctl status postgresql
# åº”æ˜¾ç¤º active (running)

# æµ‹è¯•è¿æ¥
psql -h localhost -U aiqa_user -d aiqa_production -c "SELECT version();"
# åº”æ˜¾ç¤ºPostgreSQLç‰ˆæœ¬ä¿¡æ¯ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸ

# æµ‹è¯•æ•°æ®åº“åˆ—è¡¨
psql -h localhost -U aiqa_user -d aiqa_production -c "\l"
# åº”æ˜¾ç¤ºæ•°æ®åº“åˆ—è¡¨ï¼ŒåŒ…å«aiqa_production
```

---

## ğŸ“¦ ç¬¬ä¸‰é˜¶æ®µï¼šä»£ç éƒ¨ç½²

### 3.1 å…‹éš†ä»£ç ä»“åº“

#### æ“ä½œæ­¥éª¤
```bash
# ç¡®ä¿åœ¨aiqaç”¨æˆ·ä¸‹
sudo su - aiqa

# å…‹éš†ä»£ç 
git clone https://github.com/duanxingchao/ai-qa-platform.git
cd ai-qa-platform

# æ£€æŸ¥æœ€æ–°æäº¤
git log --oneline -5

# æ£€æŸ¥åˆ†æ”¯çŠ¶æ€
git branch -a
git status
```

#### é¢„æœŸæ•ˆæœ
```
âœ… ä»£ç å…‹éš†æˆåŠŸ
âœ… å½“å‰ç›®å½•: /home/aiqa/ai-qa-platform
âœ… æœ€æ–°æäº¤åŒ…å«: feat: å®Œæˆè£è€€APIé›†æˆå’ŒMockæœåŠ¡æ”¹é€ 
âœ… åˆ†æ”¯çŠ¶æ€: On branch master, up to date
```

### 3.2 é…ç½®ç”Ÿäº§ç¯å¢ƒ

#### æ“ä½œæ­¥éª¤
```bash
# å¤åˆ¶ç”Ÿäº§ç¯å¢ƒé…ç½®
cp backend/production.env backend/.env

# ç¼–è¾‘ç¯å¢ƒé…ç½®
nano backend/.env
```

#### é…ç½®å†…å®¹ï¼ˆå®Œæ•´é…ç½®ï¼‰
```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://aiqa_user:AiQa2024#Prod@localhost:5432/aiqa_production
DATABASE_SCHEMA=public

# è£è€€APIé…ç½®
CLASSIFY_API_URL=http://aipipeline.ipd.hihonor.com/v1/workflows/run
SCORE_API_URL=http://aipipeline.ipd.hihonor.com/v1/workflows/run
SCORE_API_KEY=app-SXgaGHIf25NtJXEFmc9ecRSc
CLASSIFY_API_KEY=

# Flaské…ç½®
FLASK_ENV=production
SECRET_KEY=AiQa2024ProductionSecretKey#VerySecure
API_ENVIRONMENT=production

# æœåŠ¡é…ç½®
HOST=0.0.0.0
PORT=8088
DEBUG=False

# è°ƒåº¦å™¨é…ç½®
SCHEDULER_ENABLED=true
SYNC_INTERVAL_MINUTES=60
CLASSIFY_INTERVAL_MINUTES=30
GENERATE_INTERVAL_MINUTES=45
SCORE_INTERVAL_MINUTES=60

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=/var/log/aiqa/app.log
```

#### éªŒè¯é…ç½®
```bash
# éªŒè¯é…ç½®æ–‡ä»¶
cat backend/.env | grep -E "(DATABASE_URL|CLASSIFY_API_URL|SCORE_API_URL)"

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la backend/.env
```

#### é¢„æœŸæ•ˆæœ
```
âœ… é…ç½®æ–‡ä»¶åˆ›å»ºæˆåŠŸ
âœ… æ•°æ®åº“URLé…ç½®æ­£ç¡®
âœ… è£è€€API URLé…ç½®æ­£ç¡®
âœ… æ–‡ä»¶æƒé™: -rw-r--r-- aiqa aiqa
```

---

## ğŸ ç¬¬å››é˜¶æ®µï¼šåç«¯éƒ¨ç½²

### 4.1 å®‰è£…Pythonä¾èµ–

#### æ“ä½œæ­¥éª¤
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /home/aiqa/ai-qa-platform

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# éªŒè¯è™šæ‹Ÿç¯å¢ƒ
which python
which pip

# å‡çº§pip
pip install --upgrade pip

# å®‰è£…ä¾èµ–
pip install -r backend/requirements.txt

# éªŒè¯å…³é”®åŒ…å®‰è£…
pip list | grep -E "(Flask|SQLAlchemy|psycopg2|requests)"
```

#### é¢„æœŸæ•ˆæœ
```bash
# è™šæ‹Ÿç¯å¢ƒéªŒè¯
/home/aiqa/ai-qa-platform/venv/bin/python
/home/aiqa/ai-qa-platform/venv/bin/pip

# å…³é”®åŒ…éªŒè¯
Flask                    2.x.x
SQLAlchemy              1.x.x
psycopg2-binary         2.x.x
requests                2.x.x
```

### 4.2 åˆå§‹åŒ–æ•°æ®åº“

#### æ“ä½œæ­¥éª¤
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸”è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
cd /home/aiqa/ai-qa-platform
source venv/bin/activate

# åŠ è½½ç¯å¢ƒå˜é‡
source backend/.env

# æµ‹è¯•æ•°æ®åº“è¿æ¥
python3 -c "
import os
print('DATABASE_URL:', os.getenv('DATABASE_URL'))
"

# åˆå§‹åŒ–æ•°æ®åº“
cd backend
python -c "
from app import create_app, db
app = create_app()
with app.app_context():
    db.create_all()
    print('æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ')
"
```

#### é¢„æœŸæ•ˆæœ
```bash
# æ•°æ®åº“è¿æ¥æµ‹è¯•
DATABASE_URL: postgresql://aiqa_user:AiQa2024#Prod@localhost:5432/aiqa_production

# æ•°æ®åº“åˆå§‹åŒ–
æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ

# éªŒè¯æ•°æ®åº“è¡¨
psql -h localhost -U aiqa_user -d aiqa_production -c "\dt"
# åº”æ˜¾ç¤ºä»¥ä¸‹è¡¨ï¼š
#  public | answers    | table | aiqa_user
#  public | questions  | table | aiqa_user
#  public | scores     | table | aiqa_user
```

### 4.3 æµ‹è¯•è£è€€APIè¿æ¥

#### æ“ä½œæ­¥éª¤
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œæµ‹è¯•
cd /home/aiqa/ai-qa-platform
source venv/bin/activate
source backend/.env

# è¿è¡ŒAPIé›†æˆæµ‹è¯•
python3 backend/test_honor_api_integration.py
```

#### é¢„æœŸæ•ˆæœ
```
ğŸš€ å¼€å§‹è£è€€APIé›†æˆæµ‹è¯•
åˆ†ç±»API URL: http://aipipeline.ipd.hihonor.com/v1/workflows/run
è¯„åˆ†API URL: http://aipipeline.ipd.hihonor.com/v1/workflows/run
è¯„åˆ†API Key: app-SXgaGHIf25NtJXEFmc9ecRSc
============================================================

ğŸ” æµ‹è¯•åˆ†ç±»API...
âœ… åˆ†ç±»APIæµ‹è¯•æˆåŠŸ
   é—®é¢˜: å¦‚ä½•ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ï¼Ÿ
   åˆ†ç±»ç»“æœ: æŠ€æœ¯é—®é¢˜

ğŸ“Š æµ‹è¯•è¯„åˆ†API...
âœ… è¯„åˆ†APIæµ‹è¯•æˆåŠŸ
   é—®é¢˜: å¦‚ä½•ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ï¼Ÿ
   è¯„åˆ†ç»“æœæ•°é‡: 3

ğŸŒ ç›´æ¥æµ‹è¯•APIè°ƒç”¨...
æµ‹è¯•åˆ†ç±»APIç›´æ¥è°ƒç”¨...
âœ… åˆ†ç±»APIç›´æ¥è°ƒç”¨æˆåŠŸ

æµ‹è¯•è¯„åˆ†APIç›´æ¥è°ƒç”¨...
âœ… è¯„åˆ†APIç›´æ¥è°ƒç”¨æˆåŠŸ

============================================================
ğŸ“‹ æµ‹è¯•ç»“æœæ€»ç»“:
   åˆ†ç±»APIå®¢æˆ·ç«¯: âœ… æˆåŠŸ
   è¯„åˆ†APIå®¢æˆ·ç«¯: âœ… æˆåŠŸ

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼è£è€€APIé›†æˆé…ç½®æ­£ç¡®ã€‚
ğŸ’¡ ç°åœ¨å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä»¥ä¸‹é…ç½®:
   export CLASSIFY_API_URL='http://aipipeline.ipd.hihonor.com/v1/workflows/run'
   export SCORE_API_URL='http://aipipeline.ipd.hihonor.com/v1/workflows/run'
   export SCORE_API_KEY='app-SXgaGHIf25NtJXEFmc9ecRSc'
```

### 4.4 åˆ›å»ºå¯åŠ¨è„šæœ¬

#### æ“ä½œæ­¥éª¤
```bash
# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > /home/aiqa/ai-qa-platform/start_backend.sh << 'EOF'
#!/bin/bash
echo "å¯åŠ¨AIé—®ç­”å¹³å°åç«¯æœåŠ¡..."
cd /home/aiqa/ai-qa-platform
source venv/bin/activate
source backend/.env
cd backend
echo "ç¯å¢ƒé…ç½®åŠ è½½å®Œæˆ"
echo "å¯åŠ¨Flaskåº”ç”¨..."
python app.py
EOF

# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x /home/aiqa/ai-qa-platform/start_backend.sh

# æµ‹è¯•å¯åŠ¨è„šæœ¬ï¼ˆæŒ‰Ctrl+Cåœæ­¢ï¼‰
./start_backend.sh
```

#### é¢„æœŸæ•ˆæœ
```
å¯åŠ¨AIé—®ç­”å¹³å°åç«¯æœåŠ¡...
ç¯å¢ƒé…ç½®åŠ è½½å®Œæˆ
å¯åŠ¨Flaskåº”ç”¨...
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8088
 * Running on http://æœåŠ¡å™¨IP:8088
Press CTRL+C to quit
âœ… åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ
âœ… ç›‘å¬åœ°å€: 0.0.0.0:8088
âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
âœ… APIè·¯ç”±æ³¨å†ŒæˆåŠŸ
âœ… è°ƒåº¦å™¨å¯åŠ¨æˆåŠŸ
```

---

## ğŸ¨ ç¬¬äº”é˜¶æ®µï¼šå‰ç«¯éƒ¨ç½²

### 5.1 å®‰è£…å‰ç«¯ä¾èµ–

#### æ“ä½œæ­¥éª¤
```bash
# æ–°å¼€ç»ˆç«¯ï¼Œåˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
cd /home/aiqa/ai-qa-platform/frontend

# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version
npm --version

# å®‰è£…ä¾èµ–
npm install

# éªŒè¯å®‰è£…
ls node_modules | wc -l
npm list vue --depth=0
```

#### é¢„æœŸæ•ˆæœ
```bash
# Node.jsç‰ˆæœ¬éªŒè¯
v16.x.x æˆ–æ›´é«˜
8.x.x æˆ–æ›´é«˜

# ä¾èµ–å®‰è£…éªŒè¯
å·²å®‰è£…åŒ…æ•°é‡ > 1000
vue@3.x.x
```

### 5.2 é…ç½®å‰ç«¯ç¯å¢ƒ

#### æ“ä½œæ­¥éª¤
```bash
# è·å–æœåŠ¡å™¨IPåœ°å€
SERVER_IP=$(hostname -I | awk '{print $1}')
echo "æœåŠ¡å™¨IP: $SERVER_IP"

# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®
cat > /home/aiqa/ai-qa-platform/frontend/.env.production << EOF
# ç”Ÿäº§ç¯å¢ƒé…ç½®
VUE_APP_API_BASE_URL=http://$SERVER_IP:8088/api
VUE_APP_TITLE=AIé—®ç­”å¹³å°
NODE_ENV=production
EOF

# éªŒè¯é…ç½®
cat /home/aiqa/ai-qa-platform/frontend/.env.production
```

#### é¢„æœŸæ•ˆæœ
```bash
# æœåŠ¡å™¨IPæ˜¾ç¤º
æœåŠ¡å™¨IP: 192.168.x.x

# é…ç½®æ–‡ä»¶å†…å®¹
VUE_APP_API_BASE_URL=http://192.168.x.x:8088/api
VUE_APP_TITLE=AIé—®ç­”å¹³å°
NODE_ENV=production
```

### 5.3 æ„å»ºå‰ç«¯é¡¹ç›®

#### æ“ä½œæ­¥éª¤
```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
cd /home/aiqa/ai-qa-platform/frontend
npm run build

# éªŒè¯æ„å»ºç»“æœ
ls -la dist/
du -sh dist/

# æ£€æŸ¥å…³é”®æ–‡ä»¶
ls dist/index.html
ls dist/js/
ls dist/css/
```

#### é¢„æœŸæ•ˆæœ
```bash
# æ„å»ºæˆåŠŸä¿¡æ¯
Build complete. The dist directory is ready to be deployed.

# æ„å»ºç»“æœéªŒè¯
index.html  css/  js/  img/  favicon.ico
æ€»å¤§å°: 5-20MB

# å…³é”®æ–‡ä»¶å­˜åœ¨
dist/index.html
dist/js/app.xxx.js
dist/css/app.xxx.css
```

---

## ğŸŒ ç¬¬å…­é˜¶æ®µï¼šNginxé…ç½®

### 6.1 é…ç½®Nginx

#### æ“ä½œæ­¥éª¤
```bash
# è·å–æœåŠ¡å™¨IP
SERVER_IP=$(hostname -I | awk '{print $1}')
echo "é…ç½®Nginx for IP: $SERVER_IP"

# åˆ›å»ºNginxé…ç½®æ–‡ä»¶
sudo tee /etc/nginx/sites-available/aiqa-platform << EOF
server {
    listen 80;
    server_name $SERVER_IP;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /home/aiqa/ai-qa-platform/frontend/dist;
        try_files \$uri \$uri/ /index.html;
        index index.html;
    }

    # åç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8088/api/;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        root /home/aiqa/ai-qa-platform/frontend/dist;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/aiqa_access.log;
    error_log /var/log/nginx/aiqa_error.log;
}
EOF

# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/aiqa-platform /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤ç«™ç‚¹
sudo rm -f /etc/nginx/sites-enabled/default

# æµ‹è¯•Nginxé…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx

# éªŒè¯NginxçŠ¶æ€
sudo systemctl status nginx
```

#### é¢„æœŸæ•ˆæœ
```bash
# Nginxé…ç½®æµ‹è¯•
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

# NginxæœåŠ¡çŠ¶æ€
â— nginx.service - A high performance web server
   Loaded: loaded
   Active: active (running)
```

---

## ğŸ”„ ç¬¬ä¸ƒé˜¶æ®µï¼šç³»ç»ŸæœåŠ¡é…ç½®

### 7.1 åˆ›å»ºåç«¯ç³»ç»ŸæœåŠ¡

#### æ“ä½œæ­¥éª¤
```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/aiqa-backend.service << 'EOF'
[Unit]
Description=AI QA Platform Backend
After=network.target postgresql.service

[Service]
Type=simple
User=aiqa
Group=aiqa
WorkingDirectory=/home/aiqa/ai-qa-platform/backend
Environment=PATH=/home/aiqa/ai-qa-platform/venv/bin
EnvironmentFile=/home/aiqa/ai-qa-platform/backend/.env
ExecStart=/home/aiqa/ai-qa-platform/venv/bin/python app.py
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

# é‡è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start aiqa-backend

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable aiqa-backend

# éªŒè¯æœåŠ¡çŠ¶æ€
sudo systemctl status aiqa-backend
```

#### é¢„æœŸæ•ˆæœ
```bash
# æœåŠ¡çŠ¶æ€éªŒè¯
â— aiqa-backend.service - AI QA Platform Backend
   Loaded: loaded (/etc/systemd/system/aiqa-backend.service; enabled)
   Active: active (running) since xxx
   Main PID: xxxx (python)

# æœåŠ¡æ—¥å¿—æ£€æŸ¥
sudo journalctl -u aiqa-backend -f --lines=10
# åº”æ˜¾ç¤ºæœåŠ¡å¯åŠ¨æ—¥å¿—ï¼Œæ— é”™è¯¯ä¿¡æ¯
```

### 7.2 é…ç½®æ—¥å¿—å’Œç›‘æ§

#### æ“ä½œæ­¥éª¤
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/aiqa
sudo chown aiqa:aiqa /var/log/aiqa

# é…ç½®æ—¥å¿—è½®è½¬
sudo tee /etc/logrotate.d/aiqa-platform << 'EOF'
/var/log/aiqa/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 aiqa aiqa
}
EOF

# åˆ›å»ºç›‘æ§è„šæœ¬
cat > /home/aiqa/monitor.sh << 'EOF'
#!/bin/bash
# AIé—®ç­”å¹³å°ç›‘æ§è„šæœ¬

echo "=== $(date) ==="
echo "åç«¯æœåŠ¡çŠ¶æ€:"
systemctl is-active aiqa-backend

echo "NginxçŠ¶æ€:"
systemctl is-active nginx

echo "PostgreSQLçŠ¶æ€:"
systemctl is-active postgresql

echo "æ•°æ®åº“è¿æ¥:"
curl -s http://localhost:8088/api/health | jq '.database' 2>/dev/null || echo "APIä¸å¯ç”¨"

echo "è£è€€APIè¿æ¥:"
cd /home/aiqa/ai-qa-platform && source venv/bin/activate && python3 backend/test_honor_api_integration.py 2>/dev/null | grep "æ‰€æœ‰æµ‹è¯•é€šè¿‡" || echo "APIæµ‹è¯•å¤±è´¥"

echo "ç£ç›˜ä½¿ç”¨:"
df -h / | tail -1

echo "å†…å­˜ä½¿ç”¨:"
free -h | grep Mem

echo "========================"
EOF

chmod +x /home/aiqa/monitor.sh

# æµ‹è¯•ç›‘æ§è„šæœ¬
./monitor.sh
```

#### é¢„æœŸæ•ˆæœ
```bash
# æ—¥å¿—ç›®å½•éªŒè¯
drwxr-xr-x aiqa aiqa /var/log/aiqa

# ç›‘æ§è„šæœ¬è¾“å‡º
=== å½“å‰æ—¶é—´ ===
åç«¯æœåŠ¡çŠ¶æ€: active
NginxçŠ¶æ€: active
PostgreSQLçŠ¶æ€: active
æ•°æ®åº“è¿æ¥: "connected"
è£è€€APIè¿æ¥: ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
ç£ç›˜ä½¿ç”¨: /dev/xxx 20% ä½¿ç”¨
å†…å­˜ä½¿ç”¨: Mem: 8.0Gi 2.1Gi 4.2Gi
========================
```

---

## âœ… ç¬¬å…«é˜¶æ®µï¼šåŠŸèƒ½éªŒè¯

### 8.1 éªŒè¯åç«¯API

#### æ“ä½œæ­¥éª¤
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8088/api/health

# æµ‹è¯•æ•°æ®åº“è¿æ¥
curl http://localhost:8088/api/dashboard

# æµ‹è¯•è£è€€APIé›†æˆ
cd /home/aiqa/ai-qa-platform
source venv/bin/activate
python3 backend/test_honor_api_integration.py
```

#### é¢„æœŸæ•ˆæœ
```json
# å¥åº·æ£€æŸ¥å“åº”
{
    "status": "healthy",
    "timestamp": "2024-xx-xx xx:xx:xx",
    "database": "connected",
    "version": "1.0.0"
}

# ä»ªè¡¨æ¿å“åº”
{
    "total_questions": 0,
    "total_answers": 0,
    "total_scores": 0,
    "processing_status": {...}
}

# è£è€€APIæµ‹è¯•
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼è£è€€APIé›†æˆé…ç½®æ­£ç¡®ã€‚
```

### 8.2 éªŒè¯å‰ç«¯è®¿é—®

#### æ“ä½œæ­¥éª¤
```bash
# è·å–è®¿é—®åœ°å€
SERVER_IP=$(hostname -I | awk '{print $1}')
echo "å‰ç«¯è®¿é—®åœ°å€: http://$SERVER_IP"

# æµ‹è¯•å‰ç«¯é¡µé¢
curl -I http://localhost/

# æµ‹è¯•APIä»£ç†
curl http://localhost/api/health

# æµ‹è¯•é™æ€èµ„æº
curl -I http://localhost/js/
curl -I http://localhost/css/
```

#### é¢„æœŸæ•ˆæœ
```bash
# å‰ç«¯é¡µé¢å“åº”
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: xxxx

# APIä»£ç†å“åº”
{
    "status": "healthy",
    "timestamp": "2024-xx-xx xx:xx:xx"
}

# é™æ€èµ„æºå“åº”
HTTP/1.1 200 OK
Content-Type: application/javascript
```

### 8.3 å®Œæ•´åŠŸèƒ½æµ‹è¯•

#### æ“ä½œæ­¥éª¤
1. **æ‰“å¼€æµè§ˆå™¨è®¿é—®**: `http://æœåŠ¡å™¨IP`
2. **éªŒè¯é¡µé¢åŠ è½½**: ç¡®è®¤AIé—®ç­”å¹³å°ç•Œé¢æ­£å¸¸æ˜¾ç¤º
3. **æµ‹è¯•å¯¼èˆªèœå•**: ç‚¹å‡»å„ä¸ªèœå•é¡¹ï¼Œç¡®è®¤é¡µé¢æ­£å¸¸è·³è½¬
4. **æµ‹è¯•æ•°æ®åŒæ­¥**: åœ¨è®¾ç½®é¡µé¢æµ‹è¯•æ•°æ®åŒæ­¥åŠŸèƒ½
5. **æµ‹è¯•åˆ†ç±»åŠŸèƒ½**: éªŒè¯é—®é¢˜åˆ†ç±»æ˜¯å¦æ­£å¸¸å·¥ä½œ
6. **æµ‹è¯•è¯„åˆ†åŠŸèƒ½**: éªŒè¯ç­”æ¡ˆè¯„åˆ†æ˜¯å¦æ­£å¸¸å·¥ä½œ

#### é¢„æœŸæ•ˆæœ
```
âœ… å‰ç«¯ç•Œé¢æ­£å¸¸åŠ è½½
âœ… å¯¼èˆªèœå•åŠŸèƒ½æ­£å¸¸
âœ… æ•°æ®åŒæ­¥åŠŸèƒ½æ­£å¸¸
âœ… è£è€€åˆ†ç±»APIè°ƒç”¨æˆåŠŸ
âœ… è£è€€è¯„åˆ†APIè°ƒç”¨æˆåŠŸ
âœ… æ•°æ®åº“è¯»å†™æ­£å¸¸
âœ… æ‰€æœ‰åŠŸèƒ½æ¨¡å—æ­£å¸¸è¿è¡Œ
```

---

## ğŸ¯ éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

### âœ… ç³»ç»Ÿç¯å¢ƒ
- [ ] æœåŠ¡å™¨é…ç½®æ»¡è¶³è¦æ±‚ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- [ ] åŸºç¡€è½¯ä»¶å®‰è£…å®Œæˆï¼ˆPythonã€Node.jsã€PostgreSQLã€Nginxï¼‰
- [ ] ç”¨æˆ·æƒé™é…ç½®æ­£ç¡®ï¼ˆaiqaç”¨æˆ·åˆ›å»ºå¹¶é…ç½®sudoæƒé™ï¼‰
- [ ] ç½‘ç»œè¿é€šæ€§æ­£å¸¸ï¼ˆèƒ½è®¿é—®è£è€€APIï¼‰

### âœ… æ•°æ®åº“é…ç½®
- [ ] PostgreSQLå®‰è£…å¹¶è¿è¡Œ
- [ ] æ•°æ®åº“aiqa_productionåˆ›å»ºæˆåŠŸ
- [ ] ç”¨æˆ·aiqa_useråˆ›å»ºå¹¶æˆæƒ
- [ ] æ•°æ®è¡¨åˆå§‹åŒ–å®Œæˆï¼ˆquestionsã€answersã€scoresï¼‰
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡

### âœ… åç«¯æœåŠ¡
- [ ] Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºæˆåŠŸ
- [ ] ä¾èµ–åŒ…å®‰è£…å®Œæˆ
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] è£è€€APIè¿æ¥æµ‹è¯•é€šè¿‡
- [ ] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] systemdæœåŠ¡é…ç½®å®Œæˆ

### âœ… å‰ç«¯æœåŠ¡
- [ ] Node.jsä¾èµ–å®‰è£…å®Œæˆ
- [ ] å‰ç«¯é¡¹ç›®æ„å»ºæˆåŠŸ
- [ ] é™æ€æ–‡ä»¶ç”Ÿæˆæ­£ç¡®
- [ ] Nginxé…ç½®æ­£ç¡®
- [ ] åå‘ä»£ç†é…ç½®æ­£å¸¸

### âœ… ç³»ç»ŸæœåŠ¡
- [ ] systemdæœåŠ¡é…ç½®å®Œæˆ
- [ ] æœåŠ¡è‡ªåŠ¨å¯åŠ¨è®¾ç½®
- [ ] æ—¥å¿—é…ç½®å’Œè½®è½¬è®¾ç½®
- [ ] ç›‘æ§è„šæœ¬é…ç½®

### âœ… åŠŸèƒ½éªŒè¯
- [ ] å‰ç«¯ç•Œé¢æ­£å¸¸è®¿é—®
- [ ] åç«¯APIå“åº”æ­£å¸¸
- [ ] è£è€€APIé›†æˆæ­£å¸¸
- [ ] æ•°æ®åº“è¯»å†™æ­£å¸¸
- [ ] æ‰€æœ‰åŠŸèƒ½æ¨¡å—æµ‹è¯•é€šè¿‡

---

## ğŸš¨ æ•…éšœæ’æŸ¥æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. åç«¯æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status aiqa-backend

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u aiqa-backend -f

# å¸¸è§åŸå› åŠè§£å†³ï¼š
# - æ•°æ®åº“è¿æ¥å¤±è´¥ï¼šæ£€æŸ¥DATABASE_URLé…ç½®å’ŒPostgreSQLæœåŠ¡çŠ¶æ€
# - ç«¯å£è¢«å ç”¨ï¼šä½¿ç”¨ netstat -tlnp | grep 8088 æ£€æŸ¥ç«¯å£å ç”¨
# - æƒé™é—®é¢˜ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™å’Œç”¨æˆ·é…ç½®
# - ä¾èµ–åŒ…é—®é¢˜ï¼šé‡æ–°å®‰è£…è™šæ‹Ÿç¯å¢ƒå’Œä¾èµ–åŒ…
```

#### 2. è£è€€APIè¿æ¥å¤±è´¥
```bash
# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
ping aipipeline.ipd.hihonor.com

# æ£€æŸ¥APIé…ç½®
grep -E "(CLASSIFY_API_URL|SCORE_API_URL)" backend/.env

# æ‰‹åŠ¨æµ‹è¯•åˆ†ç±»API
curl -X POST http://aipipeline.ipd.hihonor.com/v1/workflows/run \
  -H "Content-Type: application/json" \
  -d '{"inputs":{"QUERY":"æµ‹è¯•"},"response_mode":"blocking","user":"00031559"}'

# æ‰‹åŠ¨æµ‹è¯•è¯„åˆ†API
curl -X POST http://aipipeline.ipd.hihonor.com/v1/workflows/run \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer app-SXgaGHIf25NtJXEFmc9ecRSc" \
  -d '{"inputs":{"QUERY":"æµ‹è¯•","ANSWER":"æµ‹è¯•","ANSWER_DOUBAO":"æµ‹è¯•","ANSWER_XIAOTIAN":"æµ‹è¯•","RESORT":"æŠ€æœ¯é—®é¢˜"},"response_mode":"blocking","user":"user"}'
```

#### 3. å‰ç«¯é¡µé¢æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥NginxçŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/aiqa_error.log

# æ£€æŸ¥å‰ç«¯æ–‡ä»¶æƒé™
ls -la /home/aiqa/ai-qa-platform/frontend/dist/

# å¸¸è§è§£å†³æ–¹æ¡ˆï¼š
# - é‡å¯Nginxï¼šsudo systemctl restart nginx
# - æ£€æŸ¥é˜²ç«å¢™ï¼šsudo ufw status
# - æ£€æŸ¥æ–‡ä»¶æƒé™ï¼šsudo chown -R aiqa:aiqa /home/aiqa/ai-qa-platform/
```

#### 4. æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h localhost -U aiqa_user -d aiqa_production -c "SELECT 1;"

# æ£€æŸ¥æ•°æ®åº“é…ç½®
sudo cat /etc/postgresql/12/main/pg_hba.conf | grep aiqa

# é‡å¯PostgreSQL
sudo systemctl restart postgresql
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒå’Œç»´æŠ¤

### æ—¥å¸¸ç»´æŠ¤å‘½ä»¤

#### æœåŠ¡ç®¡ç†
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status aiqa-backend nginx postgresql

# é‡å¯åç«¯æœåŠ¡
sudo systemctl restart aiqa-backend

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u aiqa-backend -f --lines=50

# é‡å¯Nginx
sudo systemctl restart nginx
```

#### ç›‘æ§å’Œæ—¥å¿—
```bash
# è¿è¡Œç›‘æ§è„šæœ¬
/home/aiqa/monitor.sh

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
df -h
free -h

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/aiqa/app.log
tail -f /var/log/nginx/aiqa_access.log
tail -f /var/log/nginx/aiqa_error.log
```

#### æ•°æ®åº“ç»´æŠ¤
```bash
# è¿æ¥æ•°æ®åº“
psql -h localhost -U aiqa_user -d aiqa_production

# æŸ¥çœ‹è¡¨çŠ¶æ€
\dt
\d questions
\d answers
\d scores

# æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
SELECT COUNT(*) FROM questions;
SELECT COUNT(*) FROM answers;
SELECT COUNT(*) FROM scores;
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - å®šæœŸæ‰§è¡ŒVACUUMå’ŒANALYZE
   - ç›‘æ§æ…¢æŸ¥è¯¢æ—¥å¿—
   - æ ¹æ®éœ€è¦æ·»åŠ ç´¢å¼•

2. **åº”ç”¨ä¼˜åŒ–**
   - ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
   - ä¼˜åŒ–APIè°ƒç”¨é¢‘ç‡
   - é…ç½®é€‚å½“çš„æ—¥å¿—çº§åˆ«

3. **ç³»ç»Ÿä¼˜åŒ–**
   - é…ç½®é€‚å½“çš„æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
   - ä¼˜åŒ–Nginxç¼“å­˜ç­–ç•¥
   - ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

**æ­å–œï¼æ‚¨çš„AIé—®ç­”å¹³å°å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼**

### ğŸ“‹ éƒ¨ç½²æ€»ç»“
- âœ… ç³»ç»Ÿç¯å¢ƒé…ç½®å®Œæˆ
- âœ… æ•°æ®åº“é…ç½®å®Œæˆ
- âœ… åç«¯æœåŠ¡éƒ¨ç½²å®Œæˆ
- âœ… å‰ç«¯æœåŠ¡éƒ¨ç½²å®Œæˆ
- âœ… è£è€€APIé›†æˆå®Œæˆ
- âœ… ç³»ç»ŸæœåŠ¡é…ç½®å®Œæˆ
- âœ… åŠŸèƒ½éªŒè¯é€šè¿‡

### ğŸŒ è®¿é—®ä¿¡æ¯
- **å‰ç«¯è®¿é—®åœ°å€**: `http://æœåŠ¡å™¨IP`
- **åç«¯APIåœ°å€**: `http://æœåŠ¡å™¨IP:8088/api`
- **å¥åº·æ£€æŸ¥**: `http://æœåŠ¡å™¨IP/api/health`

### ğŸ”§ ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status aiqa-backend

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u aiqa-backend -f

# é‡å¯æœåŠ¡
sudo systemctl restart aiqa-backend

# è¿è¡Œç›‘æ§
/home/aiqa/monitor.sh

# æµ‹è¯•è£è€€API
cd /home/aiqa/ai-qa-platform && source venv/bin/activate && python3 backend/test_honor_api_integration.py
```

### ğŸ“ˆ ä¸‹ä¸€æ­¥
1. é…ç½®åŸŸåå’ŒSSLè¯ä¹¦ï¼ˆå¯é€‰ï¼‰
2. è®¾ç½®å®šæœŸå¤‡ä»½ç­–ç•¥
3. é…ç½®ç›‘æ§å‘Šè­¦
4. æ ¹æ®ä½¿ç”¨æƒ…å†µä¼˜åŒ–æ€§èƒ½

æ‚¨çš„AIé—®ç­”å¹³å°ç°åœ¨å·²å‡†å¤‡å¥½ä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼ğŸš€
