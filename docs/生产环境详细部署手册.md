# 生产环境详细部署手册 - 荣耀API版

## 📋 部署概述

本手册提供在公司生产环境中部署AI问答平台的详细步骤，包含每一步的具体操作和预期效果。

### 🎯 部署目标
- 部署完整的AI问答平台
- 集成荣耀分类API和评分API
- 配置数据库和后端服务
- 部署前端界面
- 验证所有功能正常运行

### 📊 系统架构
```
[前端Vue.js] → [Nginx] → [后端Flask] → [荣耀API] → [PostgreSQL]
     ↓           ↓          ↓           ↓           ↓
   用户界面    反向代理   业务逻辑   AI分类评分   数据存储
```

---

## 🔧 第一阶段：环境准备

### 1.1 服务器要求检查

#### 操作步骤
```bash
# 检查操作系统版本
cat /etc/os-release

# 检查CPU和内存
lscpu | grep "CPU(s)"
free -h

# 检查磁盘空间
df -h

# 检查网络连通性
ping -c 3 aipipeline.ipd.hihonor.com
```

#### 预期效果
```
✅ 操作系统: Ubuntu 18.04+ 或 CentOS 7+
✅ CPU: 4核心以上
✅ 内存: 8GB以上
✅ 磁盘: 50GB以上可用空间
✅ 网络: 能够访问荣耀内部API (ping成功)
```

### 1.2 安装基础软件

#### 操作步骤
```bash
# 更新系统包
sudo apt update && sudo apt upgrade -y

# 安装Python 3.8+
sudo apt install python3 python3-pip python3-venv -y

# 安装Node.js 16+
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt install nodejs -y

# 安装PostgreSQL
sudo apt install postgresql postgresql-contrib -y

# 安装Git
sudo apt install git -y

# 安装Nginx
sudo apt install nginx -y

# 安装其他工具
sudo apt install curl jq htop vim -y
```

#### 预期效果
```bash
# 验证安装
python3 --version    # 应显示 Python 3.8.x 或更高
node --version       # 应显示 v16.x.x 或更高
npm --version        # 应显示 8.x.x 或更高
psql --version       # 应显示 PostgreSQL 12.x 或更高
git --version        # 应显示 git version 2.x.x
nginx -v             # 应显示 nginx version 1.x.x
```

### 1.3 创建部署用户

#### 操作步骤
```bash
# 创建部署用户
sudo useradd -m -s /bin/bash aiqa
sudo usermod -aG sudo aiqa

# 设置密码
sudo passwd aiqa

# 切换到部署用户
sudo su - aiqa

# 验证当前用户
whoami
pwd
```

#### 预期效果
```
✅ 用户aiqa创建成功
✅ 用户具有sudo权限
✅ 当前用户: aiqa
✅ 当前工作目录: /home/aiqa
```

---

## 🗄️ 第二阶段：数据库配置

### 2.1 配置PostgreSQL

#### 操作步骤
```bash
# 启动PostgreSQL服务
sudo systemctl start postgresql
sudo systemctl enable postgresql

# 验证服务状态
sudo systemctl status postgresql

# 切换到postgres用户
sudo su - postgres

# 创建数据库和用户
psql -c "CREATE DATABASE aiqa_production;"
psql -c "CREATE USER aiqa_user WITH PASSWORD 'AiQa2024#Prod';"
psql -c "GRANT ALL PRIVILEGES ON DATABASE aiqa_production TO aiqa_user;"
psql -c "ALTER USER aiqa_user CREATEDB;"

# 验证创建结果
psql -c "\l" | grep aiqa_production
psql -c "\du" | grep aiqa_user

# 退出postgres用户
exit
```

#### 预期效果
```bash
# PostgreSQL服务状态
● postgresql.service - PostgreSQL RDBMS
   Loaded: loaded
   Active: active (running)

# 数据库创建验证
aiqa_production | aiqa_user | UTF8

# 用户创建验证
aiqa_user | Create DB
```

### 2.2 配置数据库连接

#### 操作步骤
```bash
# 编辑PostgreSQL配置
sudo nano /etc/postgresql/12/main/postgresql.conf

# 修改以下配置（找到对应行并修改）
listen_addresses = 'localhost'
port = 5432

# 编辑访问控制
sudo nano /etc/postgresql/12/main/pg_hba.conf

# 在文件末尾添加以下行
local   aiqa_production   aiqa_user                     md5
host    aiqa_production   aiqa_user   127.0.0.1/32      md5

# 重启PostgreSQL
sudo systemctl restart postgresql

# 验证重启状态
sudo systemctl status postgresql
```

#### 预期效果
```bash
# 验证配置
sudo systemctl status postgresql
# 应显示 active (running)

# 测试连接
psql -h localhost -U aiqa_user -d aiqa_production -c "SELECT version();"
# 应显示PostgreSQL版本信息，表示连接成功

# 测试数据库列表
psql -h localhost -U aiqa_user -d aiqa_production -c "\l"
# 应显示数据库列表，包含aiqa_production
```

---

## 📦 第三阶段：代码部署

### 3.1 克隆代码仓库

#### 操作步骤
```bash
# 确保在aiqa用户下
sudo su - aiqa

# 克隆代码
git clone https://github.com/duanxingchao/ai-qa-platform.git
cd ai-qa-platform

# 检查最新提交
git log --oneline -5

# 检查分支状态
git branch -a
git status
```

#### 预期效果
```
✅ 代码克隆成功
✅ 当前目录: /home/aiqa/ai-qa-platform
✅ 最新提交包含: feat: 完成荣耀API集成和Mock服务改造
✅ 分支状态: On branch master, up to date
```

### 3.2 配置生产环境

#### 操作步骤
```bash
# 复制生产环境配置
cp backend/production.env backend/.env

# 编辑环境配置
nano backend/.env
```

#### 配置内容（完整配置）
```bash
# 数据库配置
DATABASE_URL=postgresql://aiqa_user:AiQa2024#Prod@localhost:5432/aiqa_production
DATABASE_SCHEMA=public

# 荣耀API配置
CLASSIFY_API_URL=http://aipipeline.ipd.hihonor.com/v1/workflows/run
SCORE_API_URL=http://aipipeline.ipd.hihonor.com/v1/workflows/run
SCORE_API_KEY=app-SXgaGHIf25NtJXEFmc9ecRSc
CLASSIFY_API_KEY=

# Flask配置
FLASK_ENV=production
SECRET_KEY=AiQa2024ProductionSecretKey#VerySecure
API_ENVIRONMENT=production

# 服务配置
HOST=0.0.0.0
PORT=8088
DEBUG=False

# 调度器配置
SCHEDULER_ENABLED=true
SYNC_INTERVAL_MINUTES=60
CLASSIFY_INTERVAL_MINUTES=30
GENERATE_INTERVAL_MINUTES=45
SCORE_INTERVAL_MINUTES=60

# 日志配置
LOG_LEVEL=INFO
LOG_FILE=/var/log/aiqa/app.log
```

#### 验证配置
```bash
# 验证配置文件
cat backend/.env | grep -E "(DATABASE_URL|CLASSIFY_API_URL|SCORE_API_URL)"

# 检查文件权限
ls -la backend/.env
```

#### 预期效果
```
✅ 配置文件创建成功
✅ 数据库URL配置正确
✅ 荣耀API URL配置正确
✅ 文件权限: -rw-r--r-- aiqa aiqa
```

---

## 🐍 第四阶段：后端部署

### 4.1 安装Python依赖

#### 操作步骤
```bash
# 确保在项目根目录
cd /home/aiqa/ai-qa-platform

# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 验证虚拟环境
which python
which pip

# 升级pip
pip install --upgrade pip

# 安装依赖
pip install -r backend/requirements.txt

# 验证关键包安装
pip list | grep -E "(Flask|SQLAlchemy|psycopg2|requests)"
```

#### 预期效果
```bash
# 虚拟环境验证
/home/aiqa/ai-qa-platform/venv/bin/python
/home/aiqa/ai-qa-platform/venv/bin/pip

# 关键包验证
Flask                    2.x.x
SQLAlchemy              1.x.x
psycopg2-binary         2.x.x
requests                2.x.x
```

### 4.2 初始化数据库

#### 操作步骤
```bash
# 确保在项目根目录且虚拟环境已激活
cd /home/aiqa/ai-qa-platform
source venv/bin/activate

# 加载环境变量
source backend/.env

# 测试数据库连接
python3 -c "
import os
print('DATABASE_URL:', os.getenv('DATABASE_URL'))
"

# 初始化数据库
cd backend
python -c "
from app import create_app, db
app = create_app()
with app.app_context():
    db.create_all()
    print('数据库表创建成功')
"
```

#### 预期效果
```bash
# 数据库连接测试
DATABASE_URL: postgresql://aiqa_user:AiQa2024#Prod@localhost:5432/aiqa_production

# 数据库初始化
数据库表创建成功

# 验证数据库表
psql -h localhost -U aiqa_user -d aiqa_production -c "\dt"
# 应显示以下表：
#  public | answers    | table | aiqa_user
#  public | questions  | table | aiqa_user
#  public | scores     | table | aiqa_user
```

### 4.3 测试荣耀API连接

#### 操作步骤
```bash
# 在项目根目录执行测试
cd /home/aiqa/ai-qa-platform
source venv/bin/activate
source backend/.env

# 运行API集成测试
python3 backend/test_honor_api_integration.py
```

#### 预期效果
```
🚀 开始荣耀API集成测试
分类API URL: http://aipipeline.ipd.hihonor.com/v1/workflows/run
评分API URL: http://aipipeline.ipd.hihonor.com/v1/workflows/run
评分API Key: app-SXgaGHIf25NtJXEFmc9ecRSc
============================================================

🔍 测试分类API...
✅ 分类API测试成功
   问题: 如何优化数据库查询性能？
   分类结果: 技术问题

📊 测试评分API...
✅ 评分API测试成功
   问题: 如何优化数据库查询性能？
   评分结果数量: 3

🌐 直接测试API调用...
测试分类API直接调用...
✅ 分类API直接调用成功

测试评分API直接调用...
✅ 评分API直接调用成功

============================================================
📋 测试结果总结:
   分类API客户端: ✅ 成功
   评分API客户端: ✅ 成功

🎉 所有测试通过！荣耀API集成配置正确。
💡 现在可以在生产环境中使用以下配置:
   export CLASSIFY_API_URL='http://aipipeline.ipd.hihonor.com/v1/workflows/run'
   export SCORE_API_URL='http://aipipeline.ipd.hihonor.com/v1/workflows/run'
   export SCORE_API_KEY='app-SXgaGHIf25NtJXEFmc9ecRSc'
```

### 4.4 创建启动脚本

#### 操作步骤
```bash
# 创建启动脚本
cat > /home/aiqa/ai-qa-platform/start_backend.sh << 'EOF'
#!/bin/bash
echo "启动AI问答平台后端服务..."
cd /home/aiqa/ai-qa-platform
source venv/bin/activate
source backend/.env
cd backend
echo "环境配置加载完成"
echo "启动Flask应用..."
python app.py
EOF

# 设置执行权限
chmod +x /home/aiqa/ai-qa-platform/start_backend.sh

# 测试启动脚本（按Ctrl+C停止）
./start_backend.sh
```

#### 预期效果
```
启动AI问答平台后端服务...
环境配置加载完成
启动Flask应用...
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8088
 * Running on http://服务器IP:8088
Press CTRL+C to quit
✅ 后端服务启动成功
✅ 监听地址: 0.0.0.0:8088
✅ 数据库连接正常
✅ API路由注册成功
✅ 调度器启动成功
```

---

## 🎨 第五阶段：前端部署

### 5.1 安装前端依赖

#### 操作步骤
```bash
# 新开终端，切换到项目目录
cd /home/aiqa/ai-qa-platform/frontend

# 检查Node.js版本
node --version
npm --version

# 安装依赖
npm install

# 验证安装
ls node_modules | wc -l
npm list vue --depth=0
```

#### 预期效果
```bash
# Node.js版本验证
v16.x.x 或更高
8.x.x 或更高

# 依赖安装验证
已安装包数量 > 1000
vue@3.x.x
```

### 5.2 配置前端环境

#### 操作步骤
```bash
# 获取服务器IP地址
SERVER_IP=$(hostname -I | awk '{print $1}')
echo "服务器IP: $SERVER_IP"

# 创建生产环境配置
cat > /home/aiqa/ai-qa-platform/frontend/.env.production << EOF
# 生产环境配置
VUE_APP_API_BASE_URL=http://$SERVER_IP:8088/api
VUE_APP_TITLE=AI问答平台
NODE_ENV=production
EOF

# 验证配置
cat /home/aiqa/ai-qa-platform/frontend/.env.production
```

#### 预期效果
```bash
# 服务器IP显示
服务器IP: 192.168.x.x

# 配置文件内容
VUE_APP_API_BASE_URL=http://192.168.x.x:8088/api
VUE_APP_TITLE=AI问答平台
NODE_ENV=production
```

### 5.3 构建前端项目

#### 操作步骤
```bash
# 构建生产版本
cd /home/aiqa/ai-qa-platform/frontend
npm run build

# 验证构建结果
ls -la dist/
du -sh dist/

# 检查关键文件
ls dist/index.html
ls dist/js/
ls dist/css/
```

#### 预期效果
```bash
# 构建成功信息
Build complete. The dist directory is ready to be deployed.

# 构建结果验证
index.html  css/  js/  img/  favicon.ico
总大小: 5-20MB

# 关键文件存在
dist/index.html
dist/js/app.xxx.js
dist/css/app.xxx.css
```

---

## 🌐 第六阶段：Nginx配置

### 6.1 配置Nginx

#### 操作步骤
```bash
# 获取服务器IP
SERVER_IP=$(hostname -I | awk '{print $1}')
echo "配置Nginx for IP: $SERVER_IP"

# 创建Nginx配置文件
sudo tee /etc/nginx/sites-available/aiqa-platform << EOF
server {
    listen 80;
    server_name $SERVER_IP;

    # 前端静态文件
    location / {
        root /home/aiqa/ai-qa-platform/frontend/dist;
        try_files \$uri \$uri/ /index.html;
        index index.html;
    }

    # 后端API代理
    location /api/ {
        proxy_pass http://127.0.0.1:8088/api/;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        root /home/aiqa/ai-qa-platform/frontend/dist;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 日志配置
    access_log /var/log/nginx/aiqa_access.log;
    error_log /var/log/nginx/aiqa_error.log;
}
EOF

# 启用站点
sudo ln -s /etc/nginx/sites-available/aiqa-platform /etc/nginx/sites-enabled/

# 删除默认站点
sudo rm -f /etc/nginx/sites-enabled/default

# 测试Nginx配置
sudo nginx -t

# 重启Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx

# 验证Nginx状态
sudo systemctl status nginx
```

#### 预期效果
```bash
# Nginx配置测试
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

# Nginx服务状态
● nginx.service - A high performance web server
   Loaded: loaded
   Active: active (running)
```

---

## 🔄 第七阶段：系统服务配置

### 7.1 创建后端系统服务

#### 操作步骤
```bash
# 创建systemd服务文件
sudo tee /etc/systemd/system/aiqa-backend.service << 'EOF'
[Unit]
Description=AI QA Platform Backend
After=network.target postgresql.service

[Service]
Type=simple
User=aiqa
Group=aiqa
WorkingDirectory=/home/aiqa/ai-qa-platform/backend
Environment=PATH=/home/aiqa/ai-qa-platform/venv/bin
EnvironmentFile=/home/aiqa/ai-qa-platform/backend/.env
ExecStart=/home/aiqa/ai-qa-platform/venv/bin/python app.py
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF

# 重载systemd配置
sudo systemctl daemon-reload

# 启动服务
sudo systemctl start aiqa-backend

# 设置开机自启
sudo systemctl enable aiqa-backend

# 验证服务状态
sudo systemctl status aiqa-backend
```

#### 预期效果
```bash
# 服务状态验证
● aiqa-backend.service - AI QA Platform Backend
   Loaded: loaded (/etc/systemd/system/aiqa-backend.service; enabled)
   Active: active (running) since xxx
   Main PID: xxxx (python)

# 服务日志检查
sudo journalctl -u aiqa-backend -f --lines=10
# 应显示服务启动日志，无错误信息
```

### 7.2 配置日志和监控

#### 操作步骤
```bash
# 创建日志目录
sudo mkdir -p /var/log/aiqa
sudo chown aiqa:aiqa /var/log/aiqa

# 配置日志轮转
sudo tee /etc/logrotate.d/aiqa-platform << 'EOF'
/var/log/aiqa/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 aiqa aiqa
}
EOF

# 创建监控脚本
cat > /home/aiqa/monitor.sh << 'EOF'
#!/bin/bash
# AI问答平台监控脚本

echo "=== $(date) ==="
echo "后端服务状态:"
systemctl is-active aiqa-backend

echo "Nginx状态:"
systemctl is-active nginx

echo "PostgreSQL状态:"
systemctl is-active postgresql

echo "数据库连接:"
curl -s http://localhost:8088/api/health | jq '.database' 2>/dev/null || echo "API不可用"

echo "荣耀API连接:"
cd /home/aiqa/ai-qa-platform && source venv/bin/activate && python3 backend/test_honor_api_integration.py 2>/dev/null | grep "所有测试通过" || echo "API测试失败"

echo "磁盘使用:"
df -h / | tail -1

echo "内存使用:"
free -h | grep Mem

echo "========================"
EOF

chmod +x /home/aiqa/monitor.sh

# 测试监控脚本
./monitor.sh
```

#### 预期效果
```bash
# 日志目录验证
drwxr-xr-x aiqa aiqa /var/log/aiqa

# 监控脚本输出
=== 当前时间 ===
后端服务状态: active
Nginx状态: active
PostgreSQL状态: active
数据库连接: "connected"
荣耀API连接: 🎉 所有测试通过！
磁盘使用: /dev/xxx 20% 使用
内存使用: Mem: 8.0Gi 2.1Gi 4.2Gi
========================
```

---

## ✅ 第八阶段：功能验证

### 8.1 验证后端API

#### 操作步骤
```bash
# 测试健康检查
curl http://localhost:8088/api/health

# 测试数据库连接
curl http://localhost:8088/api/dashboard

# 测试荣耀API集成
cd /home/aiqa/ai-qa-platform
source venv/bin/activate
python3 backend/test_honor_api_integration.py
```

#### 预期效果
```json
# 健康检查响应
{
    "status": "healthy",
    "timestamp": "2024-xx-xx xx:xx:xx",
    "database": "connected",
    "version": "1.0.0"
}

# 仪表板响应
{
    "total_questions": 0,
    "total_answers": 0,
    "total_scores": 0,
    "processing_status": {...}
}

# 荣耀API测试
🎉 所有测试通过！荣耀API集成配置正确。
```

### 8.2 验证前端访问

#### 操作步骤
```bash
# 获取访问地址
SERVER_IP=$(hostname -I | awk '{print $1}')
echo "前端访问地址: http://$SERVER_IP"

# 测试前端页面
curl -I http://localhost/

# 测试API代理
curl http://localhost/api/health

# 测试静态资源
curl -I http://localhost/js/
curl -I http://localhost/css/
```

#### 预期效果
```bash
# 前端页面响应
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: xxxx

# API代理响应
{
    "status": "healthy",
    "timestamp": "2024-xx-xx xx:xx:xx"
}

# 静态资源响应
HTTP/1.1 200 OK
Content-Type: application/javascript
```

### 8.3 完整功能测试

#### 操作步骤
1. **打开浏览器访问**: `http://服务器IP`
2. **验证页面加载**: 确认AI问答平台界面正常显示
3. **测试导航菜单**: 点击各个菜单项，确认页面正常跳转
4. **测试数据同步**: 在设置页面测试数据同步功能
5. **测试分类功能**: 验证问题分类是否正常工作
6. **测试评分功能**: 验证答案评分是否正常工作

#### 预期效果
```
✅ 前端界面正常加载
✅ 导航菜单功能正常
✅ 数据同步功能正常
✅ 荣耀分类API调用成功
✅ 荣耀评分API调用成功
✅ 数据库读写正常
✅ 所有功能模块正常运行
```

---

## 🎯 部署完成检查清单

### ✅ 系统环境
- [ ] 服务器配置满足要求（CPU、内存、磁盘）
- [ ] 基础软件安装完成（Python、Node.js、PostgreSQL、Nginx）
- [ ] 用户权限配置正确（aiqa用户创建并配置sudo权限）
- [ ] 网络连通性正常（能访问荣耀API）

### ✅ 数据库配置
- [ ] PostgreSQL安装并运行
- [ ] 数据库aiqa_production创建成功
- [ ] 用户aiqa_user创建并授权
- [ ] 数据表初始化完成（questions、answers、scores）
- [ ] 数据库连接测试通过

### ✅ 后端服务
- [ ] Python虚拟环境创建成功
- [ ] 依赖包安装完成
- [ ] 环境变量配置正确
- [ ] 荣耀API连接测试通过
- [ ] 后端服务正常运行
- [ ] systemd服务配置完成

### ✅ 前端服务
- [ ] Node.js依赖安装完成
- [ ] 前端项目构建成功
- [ ] 静态文件生成正确
- [ ] Nginx配置正确
- [ ] 反向代理配置正常

### ✅ 系统服务
- [ ] systemd服务配置完成
- [ ] 服务自动启动设置
- [ ] 日志配置和轮转设置
- [ ] 监控脚本配置

### ✅ 功能验证
- [ ] 前端界面正常访问
- [ ] 后端API响应正常
- [ ] 荣耀API集成正常
- [ ] 数据库读写正常
- [ ] 所有功能模块测试通过

---

## 🚨 故障排查指南

### 常见问题及解决方案

#### 1. 后端服务启动失败
```bash
# 检查服务状态
sudo systemctl status aiqa-backend

# 查看详细日志
sudo journalctl -u aiqa-backend -f

# 常见原因及解决：
# - 数据库连接失败：检查DATABASE_URL配置和PostgreSQL服务状态
# - 端口被占用：使用 netstat -tlnp | grep 8088 检查端口占用
# - 权限问题：检查文件权限和用户配置
# - 依赖包问题：重新安装虚拟环境和依赖包
```

#### 2. 荣耀API连接失败
```bash
# 测试网络连通性
ping aipipeline.ipd.hihonor.com

# 检查API配置
grep -E "(CLASSIFY_API_URL|SCORE_API_URL)" backend/.env

# 手动测试分类API
curl -X POST http://aipipeline.ipd.hihonor.com/v1/workflows/run \
  -H "Content-Type: application/json" \
  -d '{"inputs":{"QUERY":"测试"},"response_mode":"blocking","user":"00031559"}'

# 手动测试评分API
curl -X POST http://aipipeline.ipd.hihonor.com/v1/workflows/run \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer app-SXgaGHIf25NtJXEFmc9ecRSc" \
  -d '{"inputs":{"QUERY":"测试","ANSWER":"测试","ANSWER_DOUBAO":"测试","ANSWER_XIAOTIAN":"测试","RESORT":"技术问题"},"response_mode":"blocking","user":"user"}'
```

#### 3. 前端页面无法访问
```bash
# 检查Nginx状态
sudo systemctl status nginx

# 检查Nginx配置
sudo nginx -t

# 查看Nginx错误日志
sudo tail -f /var/log/nginx/aiqa_error.log

# 检查前端文件权限
ls -la /home/aiqa/ai-qa-platform/frontend/dist/

# 常见解决方案：
# - 重启Nginx：sudo systemctl restart nginx
# - 检查防火墙：sudo ufw status
# - 检查文件权限：sudo chown -R aiqa:aiqa /home/aiqa/ai-qa-platform/
```

#### 4. 数据库连接问题
```bash
# 检查PostgreSQL状态
sudo systemctl status postgresql

# 测试数据库连接
psql -h localhost -U aiqa_user -d aiqa_production -c "SELECT 1;"

# 检查数据库配置
sudo cat /etc/postgresql/12/main/pg_hba.conf | grep aiqa

# 重启PostgreSQL
sudo systemctl restart postgresql
```

---

## 📞 技术支持和维护

### 日常维护命令

#### 服务管理
```bash
# 查看所有服务状态
sudo systemctl status aiqa-backend nginx postgresql

# 重启后端服务
sudo systemctl restart aiqa-backend

# 查看服务日志
sudo journalctl -u aiqa-backend -f --lines=50

# 重启Nginx
sudo systemctl restart nginx
```

#### 监控和日志
```bash
# 运行监控脚本
/home/aiqa/monitor.sh

# 查看系统资源
htop
df -h
free -h

# 查看应用日志
tail -f /var/log/aiqa/app.log
tail -f /var/log/nginx/aiqa_access.log
tail -f /var/log/nginx/aiqa_error.log
```

#### 数据库维护
```bash
# 连接数据库
psql -h localhost -U aiqa_user -d aiqa_production

# 查看表状态
\dt
\d questions
\d answers
\d scores

# 查看数据统计
SELECT COUNT(*) FROM questions;
SELECT COUNT(*) FROM answers;
SELECT COUNT(*) FROM scores;
```

### 性能优化建议

1. **数据库优化**
   - 定期执行VACUUM和ANALYZE
   - 监控慢查询日志
   - 根据需要添加索引

2. **应用优化**
   - 监控内存使用情况
   - 优化API调用频率
   - 配置适当的日志级别

3. **系统优化**
   - 配置适当的文件描述符限制
   - 优化Nginx缓存策略
   - 监控磁盘空间使用

---

## 🎉 部署完成

**恭喜！您的AI问答平台已成功部署到生产环境！**

### 📋 部署总结
- ✅ 系统环境配置完成
- ✅ 数据库配置完成
- ✅ 后端服务部署完成
- ✅ 前端服务部署完成
- ✅ 荣耀API集成完成
- ✅ 系统服务配置完成
- ✅ 功能验证通过

### 🌐 访问信息
- **前端访问地址**: `http://服务器IP`
- **后端API地址**: `http://服务器IP:8088/api`
- **健康检查**: `http://服务器IP/api/health`

### 🔧 管理命令
```bash
# 查看服务状态
sudo systemctl status aiqa-backend

# 查看服务日志
sudo journalctl -u aiqa-backend -f

# 重启服务
sudo systemctl restart aiqa-backend

# 运行监控
/home/aiqa/monitor.sh

# 测试荣耀API
cd /home/aiqa/ai-qa-platform && source venv/bin/activate && python3 backend/test_honor_api_integration.py
```

### 📈 下一步
1. 配置域名和SSL证书（可选）
2. 设置定期备份策略
3. 配置监控告警
4. 根据使用情况优化性能

您的AI问答平台现在已准备好为用户提供服务！🚀
